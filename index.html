<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Los Pibes 6+6 | Oficial</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/html2canvas@1.4.1/dist/html2canvas.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Oswald:wght@700&family=Inter:wght@400;700;900&display=swap" rel="stylesheet">
    <style>
        body { 
            font-family: 'Inter', sans-serif; 
            background-color: #020617; 
            color: white;
            margin: 0;
            padding: 0;
        }
        .hero-bg {
            background: linear-gradient(to bottom, rgba(2, 6, 23, 0.6), rgba(2, 6, 23, 0.95)), 
                        url('https://images.unsplash.com/photo-1574629810360-7efbbe195018?q=80&w=2000&auto=format&fit=crop');
            background-size: cover; 
            background-position: center center; 
            background-attachment: fixed; 
            min-height: 100vh;
        }
        .glass { 
            background: rgba(255, 255, 255, 0.05); 
            backdrop-filter: blur(12px); 
            border: 1px solid rgba(255, 255, 255, 0.1); 
            transition: all 0.3s ease; 
        }
        .glass:hover { border-color: #22c55e; transform: translateY(-2px); }
        .vastago-highlight { color: #22c55e; text-shadow: 0 0 10px rgba(34, 197, 94, 0.4); }
        .nacional-highlight { color: #3b82f6; text-shadow: 0 0 10px rgba(59, 130, 246, 0.4); }
        .btn-activo { background: #22c55e; box-shadow: 0 0 20px rgba(34, 197, 94, 0.3); }
        .escudo-equipo { width: 56px; height: 56px; object-fit: contain; }
        
        .btn-descargar {
            background: linear-gradient(135deg, #22c55e 0%, #16a34a 100%);
            box-shadow: 0 4px 15px rgba(34, 197, 94, 0.3);
            transition: all 0.3s ease;
        }
        .btn-descargar:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(34, 197, 94, 0.4);
        }
        
        .btn-admin {
            background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%);
            box-shadow: 0 4px 15px rgba(239, 68, 68, 0.3);
            transition: all 0.3s ease;
        }
        .btn-admin:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(239, 68, 68, 0.4);
        }
        
        .input-goles {
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
            color: white;
            padding: 8px 12px;
            border-radius: 8px;
            width: 80px;
            text-align: center;
            font-weight: bold;
            font-size: 16px;
        }
        .input-goles:focus {
            outline: none;
            border-color: #22c55e;
            background: rgba(255, 255, 255, 0.15);
        }
        
        select.input-goles {
            cursor: pointer;
        }
        select.input-goles option {
            background: #1e293b;
            color: #ffffff;
            font-weight: bold;
        }
        select.input-goles:not(:focus) {
            color: white;
        }
        
        textarea.input-goles {
            text-align: left;
            font-weight: normal;
            font-family: 'Inter', sans-serif;
        }
        
        /* Mobile optimization */
        @media (max-width: 640px) {
            .hero-bg {
                background: linear-gradient(to bottom, rgba(2, 6, 23, 0.7), rgba(2, 6, 23, 0.95)), 
                            url('https://images.unsplash.com/photo-1574629810360-7efbbe195018?q=80&w=2000&auto=format&fit=crop');
                background-size: cover;
                background-position: center center;
                background-attachment: scroll;
            }
            .escudo-equipo { width: 40px; height: 40px; }
            .input-goles { width: 60px; font-size: 14px; }
        }
        
        /* Landscape mobile */
        @media (max-width: 900px) and (orientation: landscape) {
            .hero-bg {
                background-position: center center;
            }
        }
        
        /* Tablets portrait */
        @media (min-width: 641px) and (max-width: 1024px) and (orientation: portrait) {
            .hero-bg {
                background-position: center center;
            }
        }
    </style>
</head>
<body class="hero-bg">
    <div class="max-w-5xl mx-auto px-3 sm:px-4 py-4 sm:py-12">
        <header class="text-center mb-6 sm:mb-12">
            <h1 class="text-3xl sm:text-6xl font-black italic uppercase tracking-tighter leading-none" style="font-family: 'Oswald';">
                LOS PIBES <span class="text-green-500">6+6</span>
            </h1>
            <p class="text-slate-400 tracking-[0.2em] sm:tracking-[0.3em] uppercase text-[8px] sm:text-[10px] mt-2 sm:mt-4 font-bold">TEMPORADA 2026 | Torneo Los Pibes 6+6</p>
        </header>

        <!-- Botones Admin y Debug (esquina inferior derecha) -->
        <div class="fixed bottom-4 right-4 z-50 flex flex-col gap-2">
            <button onclick="mostrarDebugNoticias()" class="bg-purple-600/80 hover:bg-purple-700 px-2 py-2 rounded-lg font-bold text-xs text-white shadow-lg">
                üêõ
            </button>
            <button onclick="toggleAdmin()" class="btn-admin px-2 py-2 rounded-lg font-bold text-xs text-white shadow-lg">
                üîê
            </button>
        </div>

        <!-- Panel de Administraci√≥n -->
        <div id="admin-panel" class="hidden mb-6 glass rounded-2xl p-4 sm:p-6 border-2 border-red-500">
            <div class="flex justify-between items-center mb-4">
                <h2 class="text-xl sm:text-2xl font-bold text-red-400">Panel de Administraci√≥n</h2>
                <button onclick="toggleAdmin()" class="text-red-400 hover:text-red-300 text-2xl">&times;</button>
            </div>
            
            <div class="mb-4">
                <label class="text-sm font-bold text-slate-300 mb-2 block">Contrase√±a Admin:</label>
                <input type="password" id="admin-password" class="input-goles w-full max-w-xs" placeholder="Ingresa contrase√±a">
                <button onclick="verificarPassword()" class="ml-2 bg-green-500 hover:bg-green-600 px-4 py-2 rounded-lg font-bold text-sm">
                    Acceder
                </button>
            </div>

            <div id="admin-content" class="hidden">
                <!-- Selector de Temporada -->
                <div class="mb-6">
                    <label class="text-sm font-bold text-slate-300 mb-2 block">Temporada:</label>
                    <div class="flex gap-2 mb-4">
                        <button onclick="cambiarTemporadaAdmin('Apertura')" id="btn-temp-Apertura" class="px-6 py-2 rounded-xl font-bold text-sm transition-all bg-white/10 hover:bg-white/20">Apertura</button>
                        <button onclick="cambiarTemporadaAdmin('Clausura')" id="btn-temp-Clausura" class="px-6 py-2 rounded-xl font-bold text-sm transition-all bg-white/10 hover:bg-white/20">Clausura</button>
                    </div>
                </div>

                <!-- Lista de Jugadores -->
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4" id="admin-jugadores">
                    <!-- Se llena din√°micamente -->
                </div>

                <div class="mt-6 flex gap-3">
                    <button onclick="guardarGoles()" class="bg-green-500 hover:bg-green-600 px-6 py-3 rounded-xl font-bold text-sm flex-1">
                        üíæ Guardar Cambios
                    </button>
                    <button onclick="resetearGoles()" class="bg-red-500 hover:bg-red-600 px-6 py-3 rounded-xl font-bold text-sm">
                        üóëÔ∏è Resetear
                    </button>
                </div>

                <!-- Agregar Jugador Nuevo -->
                <div class="mt-6 glass rounded-xl p-4 border border-yellow-500">
                    <h3 class="font-bold text-yellow-400 mb-3 flex items-center gap-2">
                        <span class="text-xl">‚ûï</span> Agregar Jugador Invitado
                    </h3>
                    <div class="grid grid-cols-1 sm:grid-cols-3 gap-3">
                        <input type="text" id="nuevo-jugador-nombre" class="input-goles w-full" placeholder='Nombre completo (ej: Juan "El Tigre" P√©rez)'>
                        <select id="nuevo-jugador-equipo" class="input-goles w-full">
                            <option value="">Selecciona equipo...</option>
                            <option value="V√°stago F.C.">V√°stago F.C.</option>
                            <option value="Nacional F.C.">Nacional F.C.</option>
                        </select>
                        <button onclick="agregarJugadorNuevo()" class="bg-yellow-500 hover:bg-yellow-600 px-4 py-2 rounded-xl font-bold text-sm text-black">
                            ‚ûï Agregar
                        </button>
                    </div>
                    <p class="text-xs text-slate-400 mt-2">Los jugadores invitados se guardan autom√°ticamente y aparecer√°n en la lista.</p>
                </div>

                <!-- Gesti√≥n de Noticias -->
                <div class="mt-6 glass rounded-xl p-4 border border-blue-500">
                    <h3 class="font-bold text-blue-400 mb-3 flex items-center gap-2">
                        <span class="text-xl">üì∞</span> Gesti√≥n de Noticias
                    </h3>
                    
                    <!-- Agregar Noticia -->
                    <div class="mb-4 bg-white/5 p-3 rounded-lg">
                        <h4 class="text-sm font-bold text-blue-300 mb-2">Agregar Nueva Noticia</h4>
                        <div class="space-y-2">
                            <select id="tipo-noticia" class="input-goles w-full">
                                <option value="transferencia">üîÑ Transferencia</option>
                                <option value="gol">‚öΩ Gol Destacado</option>
                                <option value="lesion">üè• Lesi√≥n</option>
                                <option value="general">üì¢ Noticia General</option>
                            </select>
                            <input type="text" id="titulo-noticia" class="input-goles w-full" placeholder="T√≠tulo de la noticia">
                            <textarea id="contenido-noticia" class="input-goles w-full h-20 resize-none" placeholder="Contenido de la noticia..."></textarea>
                            
                            <!-- Selector de imagen -->
                            <div class="bg-white/5 p-3 rounded-lg border border-white/20">
                                <label class="text-xs text-slate-300 mb-2 block">üì∑ Imagen (opcional):</label>
                                <input type="file" id="imagen-noticia" accept="image/*" class="text-xs text-slate-300 w-full">
                                <div id="preview-imagen" class="mt-2 hidden">
                                    <img id="preview-img" class="w-full max-h-40 object-contain rounded-lg">
                                </div>
                            </div>
                            
                            <button onclick="agregarNoticia()" class="bg-blue-500 hover:bg-blue-600 px-4 py-2 rounded-xl font-bold text-sm w-full">
                                ‚ûï Publicar Noticia
                            </button>
                        </div>
                        <p class="text-xs text-slate-400 mt-2">üí° Tip: Puedes subir fotos desde tu galer√≠a o c√°mara</p>
                    </div>

                    <!-- Lista de Noticias -->
                    <div class="bg-white/5 p-3 rounded-lg">
                        <h4 class="text-sm font-bold text-blue-300 mb-2">Noticias Publicadas</h4>
                        <div id="admin-noticias-lista" class="space-y-2 max-h-60 overflow-y-auto">
                            <!-- Se llena din√°micamente -->
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Layout principal: Contenido completo -->
        <div class="mb-4 sm:mb-10">
                <!-- Selector de Torneo -->
                <div class="flex justify-center mb-3 sm:mb-6 bg-white/5 p-1 rounded-2xl w-fit mx-auto border border-white/10">
                    <button onclick="cambiarTorneo('Apertura')" id="btn-torneo-Apertura" class="px-6 sm:px-8 py-2 sm:py-3 rounded-xl font-bold text-sm sm:text-base transition-all">Apertura</button>
                    <button onclick="cambiarTorneo('Clausura')" id="btn-torneo-Clausura" class="px-6 sm:px-8 py-2 sm:py-3 rounded-xl font-bold text-sm sm:text-base transition-all">Clausura</button>
                </div>
                
                <!-- Selector de Vista Principal -->
                <div class="flex flex-wrap justify-center gap-1 sm:gap-2 mb-4 sm:mb-6 bg-white/5 p-1 rounded-2xl w-fit mx-auto border border-white/10 max-w-[95vw]">
                    <button onclick="cambiarVista('proxima')" id="btn-vista-proxima" class="px-2 sm:px-5 py-2 sm:py-3 rounded-xl font-bold text-[10px] sm:text-base transition-all whitespace-nowrap">Pr√≥xima Fecha</button>
                    <button onclick="cambiarVista('tabla')" id="btn-vista-tabla" class="px-3 sm:px-5 py-2 sm:py-3 rounded-xl font-bold text-[10px] sm:text-base transition-all">Tabla</button>
                    <button onclick="cambiarVista('fixture')" id="btn-vista-fixture" class="px-3 sm:px-5 py-2 sm:py-3 rounded-xl font-bold text-[10px] sm:text-base transition-all">Fixture</button>
                    <button onclick="cambiarVista('goleadores')" id="btn-vista-goleadores" class="px-2 sm:px-5 py-2 sm:py-3 rounded-xl font-bold text-[10px] sm:text-base transition-all">Goleadores</button>
                </div>

        <!-- Contenedor de Fixture/Pr√≥xima Fecha -->
        <div id="partidos-container" class="space-y-3 sm:space-y-5 text-center">
            <div class="glass rounded-xl p-6">
                <div class="text-4xl mb-3">‚öΩ</div>
                <p class="text-slate-400 text-sm">Cargando informaci√≥n del torneo...</p>
            </div>
        </div>

        <!-- Contenedor de Tabla -->
        <div id="tabla-container" class="hidden">
            <!-- Bot√≥n de descarga -->
            <div class="flex justify-end mb-3">
                <button onclick="descargarTabla()" class="btn-descargar px-4 sm:px-6 py-2 sm:py-3 rounded-xl font-bold text-sm sm:text-base text-white flex items-center gap-2">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor">
                        <path fill-rule="evenodd" d="M3 17a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zm3.293-7.707a1 1 0 011.414 0L9 10.586V3a1 1 0 112 0v7.586l1.293-1.293a1 1 0 111.414 1.414l-3 3a1 1 0 01-1.414 0l-3-3a1 1 0 010-1.414z" clip-rule="evenodd" />
                    </svg>
                    Descargar JPG
                </button>
            </div>
            
            <div id="tabla-captura" style="background: linear-gradient(to bottom, rgba(2, 6, 23, 0.85), rgba(2, 6, 23, 0.95)), url('https://images.unsplash.com/photo-1574629810360-7efbbe195018?q=80&w=2000&auto=format&fit=crop'); background-size: cover; background-position: center;" class="rounded-xl sm:rounded-2xl p-6 sm:p-8">
                <!-- Encabezado de la imagen -->
                <div class="text-center mb-6">
                    <h2 class="text-3xl sm:text-5xl font-black italic uppercase tracking-tighter leading-none mb-2" style="font-family: 'Oswald';">
                        LOS PIBES <span class="text-green-500">6+6</span>
                    </h2>
                    <p class="text-slate-300 tracking-[0.2em] uppercase text-xs sm:text-sm font-bold">TABLA DE POSICIONES</p>
                    <p class="text-slate-400 tracking-widest uppercase text-[10px] mt-1 font-bold" id="torneo-nombre-tabla">TORNEO APERTURA 2026</p>
                </div>
                
                <div class="glass rounded-xl sm:rounded-2xl overflow-x-auto">
                    <table class="w-full text-sm sm:text-base">
                        <thead class="bg-white/5">
                            <tr class="text-[10px] sm:text-sm text-slate-400 uppercase tracking-wider">
                                <th class="py-2 sm:py-4 px-2 sm:px-4 text-left">Pos</th>
                                <th class="py-2 sm:py-4 px-2 sm:px-4 text-left">Equipo</th>
                                <th class="py-2 sm:py-4 px-1 sm:px-3 text-center">PJ</th>
                                <th class="py-2 sm:py-4 px-1 sm:px-3 text-center">PG</th>
                                <th class="py-2 sm:py-4 px-1 sm:px-3 text-center">PE</th>
                                <th class="py-2 sm:py-4 px-1 sm:px-3 text-center">PP</th>
                                <th class="py-2 sm:py-4 px-1 sm:px-3 text-center">GF</th>
                                <th class="py-2 sm:py-4 px-1 sm:px-3 text-center">GC</th>
                                <th class="py-2 sm:py-4 px-1 sm:px-3 text-center">DIF</th>
                                <th class="py-2 sm:py-4 px-1 sm:px-3 text-center font-bold">PTS</th>
                            </tr>
                        </thead>
                        <tbody id="tabla-body">
                            <!-- Se llena din√°micamente -->
                        </tbody>
                    </table>
                </div>
            </div>
        </div>

        <!-- Contenedor de Goleadores -->
        <div id="goleadores-container" class="hidden">
            <!-- Bot√≥n de descarga -->
            <div class="flex justify-end mb-3">
                <button onclick="descargarGoleadores()" class="btn-descargar px-4 sm:px-6 py-2 sm:py-3 rounded-xl font-bold text-sm sm:text-base text-white flex items-center gap-2">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor">
                        <path fill-rule="evenodd" d="M3 17a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zm3.293-7.707a1 1 0 011.414 0L9 10.586V3a1 1 0 112 0v7.586l1.293-1.293a1 1 0 111.414 1.414l-3 3a1 1 0 01-1.414 0l-3-3a1 1 0 010-1.414z" clip-rule="evenodd" />
                    </svg>
                    Descargar JPG
                </button>
            </div>
            
            <div id="goleadores-captura" style="background: linear-gradient(to bottom, rgba(2, 6, 23, 0.85), rgba(2, 6, 23, 0.95)), url('https://images.unsplash.com/photo-1574629810360-7efbbe195018?q=80&w=2000&auto=format&fit=crop'); background-size: cover; background-position: center;" class="rounded-xl sm:rounded-2xl p-6 sm:p-8">
                <!-- Encabezado de la imagen -->
                <div class="text-center mb-6">
                    <h2 class="text-3xl sm:text-5xl font-black italic uppercase tracking-tighter leading-none mb-2" style="font-family: 'Oswald';">
                        LOS PIBES <span class="text-green-500">6+6</span>
                    </h2>
                    <p class="text-slate-300 tracking-[0.2em] uppercase text-xs sm:text-sm font-bold">TABLA DE GOLEADORES</p>
                    <p class="text-slate-400 tracking-widest uppercase text-[10px] mt-1 font-bold">TEMPORADA 2026</p>
                </div>
                
                <div class="glass rounded-xl sm:rounded-2xl overflow-x-auto">
                    <table class="w-full text-sm sm:text-base">
                        <thead class="bg-white/5">
                            <tr class="text-[10px] sm:text-sm text-slate-400 uppercase tracking-wider">
                                <th class="py-2 sm:py-4 px-2 sm:px-4 text-left">Pos</th>
                                <th class="py-2 sm:py-4 px-2 sm:px-4 text-left">Jugador</th>
                                <th class="py-2 sm:py-4 px-2 sm:px-4 text-left">Equipo</th>
                                <th class="py-2 sm:py-4 px-2 sm:px-4 text-center font-bold">‚öΩ Goles</th>
                            </tr>
                        </thead>
                        <tbody id="goleadores-body">
                            <!-- Se llena din√°micamente -->
                        </tbody>
                    </table>
                </div>
            </div>
        </div>

        <!-- Secci√≥n de Noticias (Siempre visible debajo del contenido principal) -->
        <div class="mt-8 sm:mt-12">
            <div class="text-center mb-6">
                <h2 class="text-2xl sm:text-4xl font-black uppercase tracking-tight mb-2" style="font-family: 'Oswald';">
                    üì∞ NOTICIAS DEL <span class="text-green-500">F√öTBOL</span>
                </h2>
                <p class="text-slate-400 text-xs sm:text-sm uppercase tracking-wider">Torneo y noticias generales</p>
            </div>
            
            <!-- Carrusel de Noticias -->
            <div class="relative overflow-hidden">
                <div id="noticias-carrusel" class="transition-opacity duration-1000 ease-in-out">
                    <!-- Se llena din√°micamente -->
                </div>
                
                <!-- Indicadores de navegaci√≥n -->
                <div class="flex justify-center gap-2 mt-4">
                    <button onclick="noticiaAnterior()" class="glass px-3 sm:px-4 py-2 rounded-xl hover:bg-white/10 transition-all text-xs sm:text-base">
                        ‚Üê Ant.
                    </button>
                    <div id="noticia-indicador" class="glass px-3 sm:px-4 py-2 rounded-xl text-xs sm:text-sm font-bold">
                        1 / 1
                    </div>
                    <button onclick="noticiaSiguiente()" class="glass px-3 sm:px-4 py-2 rounded-xl hover:bg-white/10 transition-all text-xs sm:text-base">
                        Sig. ‚Üí
                    </button>
                </div>
            </div>
        </div>

        <!-- Secci√≥n de Comentarios -->
        <div class="mt-8 sm:mt-12">
            <div class="text-center mb-6">
                <h2 class="text-xl sm:text-3xl font-black uppercase tracking-tight mb-2" style="font-family: 'Oswald';">
                    üí¨ COMENTARIOS DE LA <span class="text-green-500">FECHA</span>
                </h2>
                <p class="text-slate-400 text-xs uppercase tracking-wider">Opiniones del torneo</p>
            </div>
            
            <!-- Carrusel de Comentarios -->
            <div class="relative overflow-hidden max-w-2xl mx-auto mb-6">
                <div id="comentarios-carrusel" class="transition-opacity duration-1000 ease-in-out">
                    <!-- Se llena din√°micamente -->
                </div>
                
                <!-- Indicadores de navegaci√≥n -->
                <div class="flex justify-center gap-2 mt-3">
                    <button onclick="comentarioAnterior()" class="glass px-3 py-2 rounded-lg hover:bg-white/10 transition-all text-xs">
                        ‚Üê Ant.
                    </button>
                    <div id="comentario-indicador" class="glass px-3 py-2 rounded-lg text-xs font-bold">
                        0 / 0
                    </div>
                    <button onclick="comentarioSiguiente()" class="glass px-3 py-2 rounded-lg hover:bg-white/10 transition-all text-xs">
                        Sig. ‚Üí
                    </button>
                </div>
            </div>
            
            <!-- Formulario para comentar (m√°s compacto) -->
            <div class="glass rounded-xl p-4 max-w-xl mx-auto">
                <h3 class="text-sm font-bold mb-3 text-center">Dej√° tu comentario</h3>
                <div class="space-y-2">
                    <input type="text" id="nombre-comentario" class="input-goles w-full text-sm py-2" placeholder="Tu nombre" maxlength="50">
                    <textarea id="texto-comentario" class="input-goles w-full h-20 resize-none text-sm py-2" placeholder="Escrib√≠ tu comentario..." maxlength="300"></textarea>
                    <button onclick="enviarComentario()" class="bg-green-500 hover:bg-green-600 px-4 py-2 rounded-lg font-bold text-xs w-full">
                        üí¨ Enviar
                    </button>
                </div>
            </div>
        </div>
        </div>
    </div>

    <script>
        const API_URL = "https://script.google.com/macros/s/AKfycbw675NO52ucINehQlIo1xJcHfr7Jd-uAIi6dvhitcB0aApt_5bRBu_2UI_avNwWxdf2/exec";
        const ESCUDO_VASTAGO = "https://nqnciudad.github.io/torneo6-6/imagen/escudo-vastago.png";
        const ESCUDO_NACIONAL = "https://nqnciudad.github.io/torneo6-6/imagen/escudo-nacional.png";
        const ADMIN_PASSWORD = "pibes2026"; // Cambia esto por tu contrase√±a
        
        let torneoActual = 'Apertura';
        let vistaActual = 'proxima';
        let datosActuales = [];
        let temporadaAdmin = 'Apertura';
        let adminAutenticado = false;
        let todasLasNoticias = [];
        let noticiaActualIndex = 0;
        let carruselInterval = null;
        let todosLosComentarios = [];
        let comentarioActualIndex = 0;
        let carruselComentariosInterval = null;

        // Base de datos de jugadores
        const jugadoresDB = {
            "V√°stago F.C.": [
                { nombre: "Gabriel 'El Capi' Abas", apodo: "El Capi" },
                { nombre: "Maty 'El Picante' Pereyra", apodo: "El Picante" },
                { nombre: "Chano 'El Buda' Bertoni", apodo: "El Buda" },
                { nombre: "Jona 'El Muro' Cheves", apodo: "El Muro" },
                { nombre: "Christian 'El Rengo' Corti", apodo: "El Rengo" },
                { nombre: "Andy 'El Pela' Soto", apodo: "El Pela" },
                { nombre: "Carlos 'M√°gico' Lucero", apodo: "M√°gico" },
                { nombre: "Pablito 'El Tucu' Figueroa Alcorta", apodo: "El Tucu" },
                { nombre: "Juli√°n 'La Joya' Ib√°√±ez", apodo: "La Joya" },
                { nombre: "Juan 'La Esperanza' De Giorgis", apodo: "La Esperanza" },
                { nombre: "Gabriel 'El Zurdo' Alonso", apodo: "El Zurdo" }
            ],
            "Nacional F.C.": [
                { nombre: "Franco 'Matio' Matievich", apodo: "Matio" },
                { nombre: "Ricardo 'La Chancha' Mendoza", apodo: "La Chancha" },
                { nombre: "Fernando 'Me Lesiono' Dominguez", apodo: "Me Lesiono" },
                { nombre: "Pablo 'Caballo' Jorgensen", apodo: "Caballo" },
                { nombre: "Rodrigo 'Zerafo' Gatti", apodo: "Zerafo" },
                { nombre: "Jose 'Gambeta' Gatica", apodo: "Gambeta" },
                { nombre: "Pedro 'El Barba' Oliver", apodo: "El Barba" },
                { nombre: "Damian 'Damiao' Moller", apodo: "Damiao" },
                { nombre: "Javier 'El Profe' Llarena", apodo: "El Profe" },
                { nombre: "Gerardo 'Cari√±oso' Esperanza", apodo: "Cari√±oso" },
                { nombre: "Andres 'La Tripa' Fern√°ndez", apodo: "La Tripa" }
            ]
        };

        function obtenerInfoEquipo(nombreEquipo) {
            if (nombreEquipo.includes("V√°stago")) {
                return { escudo: ESCUDO_VASTAGO, clase: "vastago-highlight", borderColor: "border-green-500", bgColor: "bg-green-500/5" };
            } else if (nombreEquipo.includes("Nacional")) {
                return { escudo: ESCUDO_NACIONAL, clase: "nacional-highlight", borderColor: "border-blue-500", bgColor: "bg-blue-500/5" };
            }
            return { escudo: null, clase: "", borderColor: "border-transparent", bgColor: "" };
        }

        // Funciones de Admin
        function toggleAdmin() {
            const panel = document.getElementById('admin-panel');
            panel.classList.toggle('hidden');
            if (!panel.classList.contains('hidden') && adminAutenticado) {
                cargarPanelAdmin();
                cargarNoticiasAdmin();
            }
        }

        function verificarPassword() {
            const password = document.getElementById('admin-password').value;
            if (password === ADMIN_PASSWORD) {
                adminAutenticado = true;
                document.getElementById('admin-content').classList.remove('hidden');
                cargarPanelAdmin();
                cargarNoticiasAdmin();
            } else {
                alert('‚ùå Contrase√±a incorrecta');
            }
        }

        function cambiarTemporadaAdmin(temp) {
            temporadaAdmin = temp;
            document.querySelectorAll('[id^="btn-temp-"]').forEach(b => b.classList.remove('btn-activo'));
            document.getElementById('btn-temp-' + temp).classList.add('btn-activo');
            cargarPanelAdmin();
        }

        function cargarPanelAdmin() {
            const container = document.getElementById('admin-jugadores');
            container.innerHTML = '';
            
            const golesGuardados = JSON.parse(localStorage.getItem('goles_' + temporadaAdmin) || '{}');
            const jugadoresCustom = JSON.parse(localStorage.getItem('jugadores_custom') || '{}');
            
            Object.keys(jugadoresDB).forEach(equipo => {
                const info = obtenerInfoEquipo(equipo);
                
                const equipoDiv = document.createElement('div');
                equipoDiv.className = 'glass rounded-xl p-4 border-l-4 ' + info.borderColor;
                equipoDiv.innerHTML = `
                    <div class="flex items-center gap-2 mb-4">
                        ${info.escudo ? `<img src="${info.escudo}" class="w-10 h-10">` : ''}
                        <h3 class="font-bold text-lg ${info.clase}">${equipo}</h3>
                    </div>
                    <div class="space-y-2">
                        ${jugadoresDB[equipo].map(jugador => {
                            const key = equipo + '|' + jugador.nombre;
                            const goles = golesGuardados[key] || 0;
                            
                            // Verificar si es un jugador invitado (custom)
                            const esInvitado = jugadoresCustom[equipo] && 
                                             jugadoresCustom[equipo].some(j => j.nombre === jugador.nombre);
                            
                            return `
                                <div class="flex justify-between items-center gap-2 bg-white/5 p-2 rounded-lg ${esInvitado ? 'border border-yellow-500/30' : ''}">
                                    <span class="text-sm font-medium flex-1 ${esInvitado ? 'text-yellow-300' : ''}">${jugador.nombre}</span>
                                    <input type="number" 
                                           class="input-goles" 
                                           id="goles-${key.replace(/[^a-zA-Z0-9]/g, '_')}"
                                           value="${goles}" 
                                           min="0"
                                           data-key="${key}">
                                    <button onclick="transferirJugador('${equipo}', '${jugador.nombre.replace(/'/g, "\\'")}', ${esInvitado}, event)" 
                                            class="bg-blue-500 hover:bg-blue-600 text-white px-2 py-1 rounded text-xs font-bold"
                                            title="Transferir a otro equipo">
                                        ‚áÑ
                                    </button>
                                    ${esInvitado ? `
                                        <button onclick="eliminarJugador('${equipo}', '${jugador.nombre.replace(/'/g, "\\'")}', event)" 
                                                class="bg-red-500 hover:bg-red-600 text-white px-2 py-1 rounded text-xs font-bold"
                                                title="Eliminar jugador">
                                            üóëÔ∏è
                                        </button>
                                    ` : ''}
                                </div>
                            `;
                        }).join('')}
                    </div>
                `;
                container.appendChild(equipoDiv);
            });
            
            // Activar bot√≥n de temporada
            document.querySelectorAll('[id^="btn-temp-"]').forEach(b => b.classList.remove('btn-activo'));
            document.getElementById('btn-temp-' + temporadaAdmin).classList.add('btn-activo');
        }

        function guardarGoles() {
            const goles = {};
            const inputs = document.querySelectorAll('.input-goles[data-key]');
            
            inputs.forEach(input => {
                const key = input.getAttribute('data-key');
                const valor = parseInt(input.value) || 0;
                if (valor > 0) {
                    goles[key] = valor;
                }
            });
            
            localStorage.setItem('goles_' + temporadaAdmin, JSON.stringify(goles));
            alert('‚úÖ Goles guardados correctamente para ' + temporadaAdmin);
            
            // Recargar goleadores si estamos en esa vista
            if (vistaActual === 'goleadores') {
                cargarGoleadoresLocal();
            }
        }

        function resetearGoles() {
            if (confirm('‚ö†Ô∏è ¬øEst√°s seguro de que quieres resetear TODOS los goles de ' + temporadaAdmin + '?')) {
                localStorage.removeItem('goles_' + temporadaAdmin);
                cargarPanelAdmin();
                alert('‚úÖ Goles reseteados');
            }
        }

        function agregarJugadorNuevo() {
            const nombre = document.getElementById('nuevo-jugador-nombre').value.trim();
            const equipo = document.getElementById('nuevo-jugador-equipo').value;
            
            if (!nombre) {
                alert('‚ùå Por favor ingresa el nombre del jugador');
                return;
            }
            
            if (!equipo) {
                alert('‚ùå Por favor selecciona un equipo');
                return;
            }
            
            // Verificar si el jugador ya existe
            const yaExiste = jugadoresDB[equipo].some(j => j.nombre === nombre);
            if (yaExiste) {
                alert('‚ö†Ô∏è Este jugador ya existe en ' + equipo);
                return;
            }
            
            // Agregar jugador a la base de datos
            jugadoresDB[equipo].push({ nombre: nombre, apodo: "" });
            
            // Guardar jugadores personalizados en localStorage
            const jugadoresCustom = JSON.parse(localStorage.getItem('jugadores_custom') || '{}');
            if (!jugadoresCustom[equipo]) {
                jugadoresCustom[equipo] = [];
            }
            jugadoresCustom[equipo].push({ nombre: nombre, apodo: "" });
            localStorage.setItem('jugadores_custom', JSON.stringify(jugadoresCustom));
            
            // Limpiar campos
            document.getElementById('nuevo-jugador-nombre').value = '';
            document.getElementById('nuevo-jugador-equipo').value = '';
            
            // Recargar panel
            cargarPanelAdmin();
            
            alert('‚úÖ Jugador agregado: ' + nombre + ' ‚Üí ' + equipo);
        }

        function cargarJugadoresCustom() {
            const jugadoresCustom = JSON.parse(localStorage.getItem('jugadores_custom') || '{}');
            
            Object.keys(jugadoresCustom).forEach(equipo => {
                jugadoresCustom[equipo].forEach(jugador => {
                    const yaExiste = jugadoresDB[equipo].some(j => j.nombre === jugador.nombre);
                    if (!yaExiste) {
                        jugadoresDB[equipo].push(jugador);
                    }
                });
            });
        }

        function eliminarJugador(equipo, nombreJugador, event) {
            event.preventDefault();
            event.stopPropagation();
            
            if (!confirm(`‚ö†Ô∏è ¬øEst√°s seguro de eliminar a "${nombreJugador}" de ${equipo}?\n\nEsto eliminar√° todos sus goles registrados en todas las temporadas.`)) {
                return;
            }
            
            // Eliminar de la base de datos en memoria
            const index = jugadoresDB[equipo].findIndex(j => j.nombre === nombreJugador);
            if (index !== -1) {
                jugadoresDB[equipo].splice(index, 1);
            }
            
            // Eliminar de jugadores custom en localStorage
            const jugadoresCustom = JSON.parse(localStorage.getItem('jugadores_custom') || '{}');
            if (jugadoresCustom[equipo]) {
                jugadoresCustom[equipo] = jugadoresCustom[equipo].filter(j => j.nombre !== nombreJugador);
                if (jugadoresCustom[equipo].length === 0) {
                    delete jugadoresCustom[equipo];
                }
                localStorage.setItem('jugadores_custom', JSON.stringify(jugadoresCustom));
            }
            
            // Eliminar goles de todas las temporadas
            ['Apertura', 'Clausura'].forEach(temp => {
                const goles = JSON.parse(localStorage.getItem('goles_' + temp) || '{}');
                const key = equipo + '|' + nombreJugador;
                if (goles[key]) {
                    delete goles[key];
                    localStorage.setItem('goles_' + temp, JSON.stringify(goles));
                }
            });
            
            // Recargar panel
            cargarPanelAdmin();
            
            // Recargar tabla de goleadores si est√° visible
            if (vistaActual === 'goleadores') {
                cargarGoleadoresLocal();
            }
            
            alert('‚úÖ Jugador eliminado: ' + nombreJugador);
        }

        function transferirJugador(equipoOrigen, nombreJugador, esInvitado, event) {
            event.preventDefault();
            event.stopPropagation();
            
            const equipoDestino = equipoOrigen === "V√°stago F.C." ? "Nacional F.C." : "V√°stago F.C.";
            
            if (!confirm(`üîÑ ¬øTransferir a "${nombreJugador}" de ${equipoOrigen} a ${equipoDestino}?\n\nSus goles anteriores con ${equipoOrigen} se mantendr√°n en la tabla de goleadores.\nAhora podr√°s cargar sus nuevos goles con ${equipoDestino}.`)) {
                return;
            }
            
            // Verificar si ya existe en el equipo destino
            const yaExiste = jugadoresDB[equipoDestino].some(j => j.nombre === nombreJugador);
            if (!yaExiste) {
                jugadoresDB[equipoDestino].push({ nombre: nombreJugador, apodo: "" });
            }
            
            // Actualizar jugadores custom en localStorage
            const jugadoresCustom = JSON.parse(localStorage.getItem('jugadores_custom') || '{}');
            
            // Mantener en el equipo origen (si es invitado, ya estaba; si es titular, lo agregamos)
            if (!jugadoresCustom[equipoOrigen]) {
                jugadoresCustom[equipoOrigen] = [];
            }
            const existeEnOrigen = jugadoresCustom[equipoOrigen].some(j => j.nombre === nombreJugador);
            if (!existeEnOrigen && !esInvitado) {
                // Si es jugador titular, lo marcamos como custom en origen para poder seguir gestionando
                jugadoresCustom[equipoOrigen].push({ nombre: nombreJugador, apodo: "" });
            }
            
            // Agregar al equipo destino
            if (!jugadoresCustom[equipoDestino]) {
                jugadoresCustom[equipoDestino] = [];
            }
            const existeEnDestino = jugadoresCustom[equipoDestino].some(j => j.nombre === nombreJugador);
            if (!existeEnDestino) {
                jugadoresCustom[equipoDestino].push({ nombre: nombreJugador, apodo: "" });
            }
            
            localStorage.setItem('jugadores_custom', JSON.stringify(jugadoresCustom));
            
            // Los goles se mantienen con sus claves originales (equipo|nombre)
            // Esto permite ver el historial completo en la tabla de goleadores
            
            // Recargar panel
            cargarPanelAdmin();
            
            // Recargar tabla de goleadores si est√° visible
            if (vistaActual === 'goleadores') {
                cargarGoleadoresLocal();
            }
            
            alert(`‚úÖ Jugador transferido:\n"${nombreJugador}"\n${equipoOrigen} ‚Üí ${equipoDestino}\n\n‚úì Ahora aparece en AMBOS equipos\n‚úì Sus goles con ${equipoOrigen} se mantienen\n‚úì Pod√©s cargar nuevos goles con ${equipoDestino}`);
        }

        function cambiarTorneo(torneo) {
            torneoActual = torneo;
            document.querySelectorAll('[id^="btn-torneo-"]').forEach(b => b.classList.remove('btn-activo'));
            document.getElementById('btn-torneo-' + torneo).classList.add('btn-activo');
            
            // Actualizar el nombre del torneo en el encabezado de la tabla
            const nombreTorneo = document.getElementById('torneo-nombre-tabla');
            if (nombreTorneo) {
                nombreTorneo.textContent = `TORNEO ${torneo.toUpperCase()} 2026`;
            }
            
            // Solo cargar datos si la vista actual lo requiere
            if (vistaActual !== 'goleadores') {
                cargarDatos();
            }
        }

        function cambiarVista(vista) {
            vistaActual = vista;
            document.querySelectorAll('[id^="btn-vista-"]').forEach(b => b.classList.remove('btn-activo'));
            document.getElementById('btn-vista-' + vista).classList.add('btn-activo');
            
            document.getElementById('partidos-container').classList.add('hidden');
            document.getElementById('tabla-container').classList.add('hidden');
            document.getElementById('goleadores-container').classList.add('hidden');
            
            if (vista === 'tabla') {
                document.getElementById('tabla-container').classList.remove('hidden');
                generarTabla();
            } else if (vista === 'goleadores') {
                document.getElementById('goleadores-container').classList.remove('hidden');
                cargarGoleadoresLocal();
            } else {
                document.getElementById('partidos-container').classList.remove('hidden');
                mostrarPartidos();
            }
        }

        function agregarNoticia() {
            const tipo = document.getElementById('tipo-noticia').value;
            const titulo = document.getElementById('titulo-noticia').value.trim();
            const contenido = document.getElementById('contenido-noticia').value.trim();
            const imagenFile = document.getElementById('imagen-noticia').files[0];
            
            if (!titulo) {
                alert('‚ùå Por favor ingresa un t√≠tulo');
                return;
            }
            
            if (!contenido) {
                alert('‚ùå Por favor ingresa el contenido');
                return;
            }
            
            // Si hay imagen, convertirla a Base64
            if (imagenFile) {
                // Validar tama√±o (m√°ximo 2MB)
                if (imagenFile.size > 2 * 1024 * 1024) {
                    alert('‚ùå La imagen es muy grande. M√°ximo 2MB.');
                    return;
                }
                
                const reader = new FileReader();
                reader.onload = function(e) {
                    guardarNoticia(tipo, titulo, contenido, e.target.result);
                };
                reader.readAsDataURL(imagenFile);
            } else {
                guardarNoticia(tipo, titulo, contenido, null);
            }
        }

        async function guardarNoticia(tipo, titulo, contenido, imagenBase64) {
            try {
                const noticia = {
                    id: Date.now(),
                    tipo: tipo,
                    titulo: titulo,
                    contenido: contenido,
                    imagen: imagenBase64 || '',
                    fecha: new Date().toISOString()
                };
                
                // Guardar en Google Sheets
                const formData = new URLSearchParams();
                formData.append('accion', 'guardarNoticia');
                formData.append('id', noticia.id);
                formData.append('tipo', noticia.tipo);
                formData.append('titulo', noticia.titulo);
                formData.append('contenido', noticia.contenido);
                formData.append('imagen', noticia.imagen);
                formData.append('fecha', noticia.fecha);
                
                const response = await fetch(API_URL, {
                    method: 'POST',
                    body: formData
                });
                
                const result = await response.json();
                
                if (result.success) {
                    // Limpiar campos
                    document.getElementById('titulo-noticia').value = '';
                    document.getElementById('contenido-noticia').value = '';
                    document.getElementById('imagen-noticia').value = '';
                    const previewDiv = document.getElementById('preview-imagen');
                    if (previewDiv) previewDiv.classList.add('hidden');
                    
                    // Actualizar listas
                    cargarNoticiasAdmin();
                    mostrarNoticias();
                    
                    alert('‚úÖ Noticia publicada correctamente');
                } else {
                    alert('‚ùå Error al guardar: ' + (result.error || 'Error desconocido'));
                }
            } catch (error) {
                console.error('Error guardando noticia:', error);
                alert('‚ùå Error de conexi√≥n al guardar la noticia');
            }
        }

        async function eliminarNoticia(id) {
            if (!confirm('¬øEst√°s seguro de eliminar esta noticia?')) {
                return;
            }
            
            try {
                const formData = new URLSearchParams();
                formData.append('accion', 'eliminarNoticia');
                formData.append('id', id);
                
                const response = await fetch(API_URL, {
                    method: 'POST',
                    body: formData
                });
                
                const result = await response.json();
                
                if (result.success) {
                    cargarNoticiasAdmin();
                    mostrarNoticias();
                    alert('‚úÖ Noticia eliminada');
                } else {
                    alert('‚ùå Error al eliminar: ' + (result.error || 'Error desconocido'));
                }
            } catch (error) {
                console.error('Error eliminando noticia:', error);
                alert('‚ùå Error de conexi√≥n al eliminar la noticia');
            }
        }

        let noticiaEditando = null;

        function editarNoticia(noticia) {
            noticiaEditando = noticia;
            
            // Llenar el formulario con los datos de la noticia
            document.getElementById('tipo-noticia').value = noticia.tipo;
            document.getElementById('titulo-noticia').value = noticia.titulo;
            document.getElementById('contenido-noticia').value = noticia.contenido;
            
            // Si tiene imagen, mostrar preview
            if (noticia.imagen && noticia.imagen.trim() !== '') {
                const previewImg = document.getElementById('preview-img');
                const previewDiv = document.getElementById('preview-imagen');
                if (previewImg && previewDiv) {
                    previewImg.src = noticia.imagen;
                    previewDiv.classList.remove('hidden');
                }
            }
            
            // Cambiar el bot√≥n de "Publicar" a "Actualizar"
            const btnPublicar = document.querySelector('button[onclick="agregarNoticia()"]');
            if (btnPublicar) {
                btnPublicar.textContent = '‚úèÔ∏è Actualizar Noticia';
                btnPublicar.onclick = function() { guardarEdicion(); };
                btnPublicar.classList.remove('bg-blue-500', 'hover:bg-blue-600');
                btnPublicar.classList.add('bg-yellow-500', 'hover:bg-yellow-600');
            }
            
            // Scroll al formulario
            document.getElementById('tipo-noticia').scrollIntoView({ behavior: 'smooth', block: 'center' });
            
            alert('‚úèÔ∏è Editando noticia. Modific√° los campos y hac√© clic en "Actualizar".');
        }

        async function guardarEdicion() {
            if (!noticiaEditando) {
                alert('‚ùå No hay noticia seleccionada para editar');
                return;
            }
            
            const tipo = document.getElementById('tipo-noticia').value;
            const titulo = document.getElementById('titulo-noticia').value.trim();
            const contenido = document.getElementById('contenido-noticia').value.trim();
            const imagenFile = document.getElementById('imagen-noticia').files[0];
            
            if (!titulo) {
                alert('‚ùå Por favor ingresa un t√≠tulo');
                return;
            }
            
            if (!contenido) {
                alert('‚ùå Por favor ingresa el contenido');
                return;
            }
            
            // Si hay nueva imagen, convertirla
            if (imagenFile) {
                if (imagenFile.size > 2 * 1024 * 1024) {
                    alert('‚ùå La imagen es muy grande. M√°ximo 2MB.');
                    return;
                }
                
                const reader = new FileReader();
                reader.onload = async function(e) {
                    await enviarEdicion(tipo, titulo, contenido, e.target.result);
                };
                reader.readAsDataURL(imagenFile);
            } else {
                // Mantener la imagen anterior
                await enviarEdicion(tipo, titulo, contenido, noticiaEditando.imagen);
            }
        }

        async function enviarEdicion(tipo, titulo, contenido, imagenBase64) {
            try {
                const formData = new URLSearchParams();
                formData.append('accion', 'editarNoticia');
                formData.append('id', noticiaEditando.id);
                formData.append('tipo', tipo);
                formData.append('titulo', titulo);
                formData.append('contenido', contenido);
                formData.append('imagen', imagenBase64 || '');
                formData.append('fecha', noticiaEditando.fecha);
                
                const response = await fetch(API_URL, {
                    method: 'POST',
                    body: formData
                });
                
                const result = await response.json();
                
                if (result.success) {
                    // Limpiar formulario
                    document.getElementById('titulo-noticia').value = '';
                    document.getElementById('contenido-noticia').value = '';
                    document.getElementById('imagen-noticia').value = '';
                    const previewDiv = document.getElementById('preview-imagen');
                    if (previewDiv) previewDiv.classList.add('hidden');
                    
                    // Restaurar bot√≥n a "Publicar"
                    const btnPublicar = document.querySelector('button[onclick="guardarEdicion()"]');
                    if (btnPublicar) {
                        btnPublicar.textContent = '‚ûï Publicar Noticia';
                        btnPublicar.onclick = function() { agregarNoticia(); };
                        btnPublicar.classList.remove('bg-yellow-500', 'hover:bg-yellow-600');
                        btnPublicar.classList.add('bg-blue-500', 'hover:bg-blue-600');
                    }
                    
                    noticiaEditando = null;
                    
                    // Actualizar listas
                    cargarNoticiasAdmin();
                    mostrarNoticias();
                    
                    alert('‚úÖ Noticia actualizada correctamente');
                } else {
                    alert('‚ùå Error al actualizar: ' + (result.error || 'Error desconocido'));
                }
            } catch (error) {
                console.error('Error actualizando noticia:', error);
                alert('‚ùå Error de conexi√≥n al actualizar la noticia');
            }
        }

        async function cargarNoticiasAdmin() {
            const container = document.getElementById('admin-noticias-lista');
            
            try {
                const response = await fetch(API_URL + '?accion=obtenerNoticias&t=' + new Date().getTime());
                const noticias = await response.json();
                
                if (noticias.error) {
                    container.innerHTML = '<p class="text-xs text-red-400 text-center py-2">' + noticias.error + '</p>';
                    return;
                }
                
                if (noticias.length === 0) {
                    container.innerHTML = '<p class="text-xs text-slate-400 text-center py-2">No hay noticias publicadas</p>';
                    return;
                }
                
                container.innerHTML = noticias.map(noticia => {
                    const iconos = {
                        transferencia: 'üîÑ',
                        gol: '‚öΩ',
                        lesion: 'üè•',
                        general: 'üì¢'
                    };
                    
                    const tieneImagen = noticia.imagen && noticia.imagen.trim() !== '';
                    
                    return `
                        <div class="bg-white/10 p-2 rounded text-xs">
                            <div class="flex justify-between items-start gap-2">
                                <span class="font-bold flex-1">${iconos[noticia.tipo] || 'üì¢'} ${noticia.titulo} ${tieneImagen ? 'üñºÔ∏è' : ''}</span>
                                <div class="flex gap-1">
                                    <button onclick='editarNoticia(${JSON.stringify(noticia)})' class="text-blue-400 hover:text-blue-300" title="Editar">‚úèÔ∏è</button>
                                    <button onclick="eliminarNoticia(${noticia.id})" class="text-red-400 hover:text-red-300" title="Eliminar">üóëÔ∏è</button>
                                </div>
                            </div>
                        </div>
                    `;
                }).join('');
            } catch (error) {
                console.error('Error cargando noticias admin:', error);
                container.innerHTML = '<p class="text-xs text-red-400 text-center py-2">Error cargando noticias</p>';
            }
        }

        function mostrarNoticias() {
            cargarTodasLasNoticias();
        }

        async function cargarTodasLasNoticias() {
            try {
                // Obtener noticias del torneo desde Google Sheets
                const response = await fetch(API_URL + '?accion=obtenerNoticias&t=' + new Date().getTime());
                const noticiasLocales = await response.json();
                
                console.log('Noticias locales cargadas:', noticiasLocales.length, noticiasLocales);
                
                // Obtener noticias de f√∫tbol general
                const noticiasFutbol = await obtenerNoticiasFutbol();
                console.log('Noticias de f√∫tbol cargadas:', noticiasFutbol.length, noticiasFutbol);
                
                // Combinar todas las noticias
                todasLasNoticias = [
                    ...(Array.isArray(noticiasLocales) ? noticiasLocales.map(n => ({ ...n, origen: 'torneo' })) : []),
                    ...noticiasFutbol.map(n => ({ ...n, origen: 'futbol' }))
                ];
                
                console.log('Total noticias combinadas:', todasLasNoticias.length, todasLasNoticias);
                
                if (todasLasNoticias.length === 0) {
                    document.getElementById('noticias-carrusel').innerHTML = `
                        <div class="glass rounded-2xl p-8 text-center">
                            <div class="text-6xl mb-4">üì∞</div>
                            <h3 class="text-xl font-bold text-slate-300 mb-2">No hay noticias todav√≠a</h3>
                            <p class="text-slate-400 text-sm">Las noticias aparecer√°n aqu√≠</p>
                        </div>
                    `;
                    return;
                }
                
                // Iniciar carrusel
                noticiaActualIndex = 0;
                mostrarNoticiaActual();
                iniciarCarruselAutomatico();
            } catch (error) {
                console.error('Error cargando todas las noticias:', error);
                document.getElementById('noticias-carrusel').innerHTML = `
                    <div class="glass rounded-2xl p-8 text-center">
                        <div class="text-6xl mb-4">‚ùå</div>
                        <h3 class="text-xl font-bold text-red-400 mb-2">Error cargando noticias</h3>
                        <p class="text-slate-400 text-sm">${error.message}</p>
                    </div>
                `;
            }
        }

        async function obtenerNoticiasFutbol() {
            try {
                const noticias = [];
                const corsProxy = 'https://api.allorigins.win/raw?url=';
                const timeout = 3000; // 3 segundos m√°ximo por fuente
                
                // Funci√≥n para fetch con timeout
                const fetchWithTimeout = async (url, timeoutMs) => {
                    const controller = new AbortController();
                    const timeoutId = setTimeout(() => controller.abort(), timeoutMs);
                    try {
                        const response = await fetch(url, { signal: controller.signal });
                        clearTimeout(timeoutId);
                        return response;
                    } catch (error) {
                        clearTimeout(timeoutId);
                        throw error;
                    }
                };
                
                // Intentar cargar de Ol√© (con timeout)
                try {
                    const rssOle = await fetchWithTimeout(corsProxy + encodeURIComponent('https://www.ole.com.ar/rss/ultimas-noticias/'), timeout);
                    const textOle = await rssOle.text();
                    const noticiasOle = parsearRSS(textOle, 'Ol√©');
                    noticias.push(...noticiasOle.slice(0, 2));
                } catch (error) {
                    console.log('Ol√© timeout o error');
                }
                
                // Si ya tenemos noticias, retornar inmediatamente
                if (noticias.length > 0) {
                    return noticias;
                }
                
                // Si no, usar ejemplos
                return obtenerNoticiasEjemplo();
            } catch (error) {
                console.error('Error al obtener noticias:', error);
                return obtenerNoticiasEjemplo();
            }
        }

        function parsearRSS(xmlText, fuente) {
            try {
                const parser = new DOMParser();
                const xmlDoc = parser.parseFromString(xmlText, 'text/xml');
                
                const items = xmlDoc.querySelectorAll('item');
                const noticias = [];
                
                items.forEach((item, index) => {
                    if (index < 5) { // Solo tomar las primeras 5 noticias
                        const titulo = item.querySelector('title')?.textContent || 'Sin t√≠tulo';
                        let descripcion = item.querySelector('description')?.textContent || '';
                        
                        // Limpiar HTML de la descripci√≥n si existe
                        const tempDiv = document.createElement('div');
                        tempDiv.innerHTML = descripcion;
                        descripcion = tempDiv.textContent || tempDiv.innerText || descripcion;
                        
                        // Limitar longitud de descripci√≥n
                        if (descripcion.length > 200) {
                            descripcion = descripcion.substring(0, 200) + '...';
                        }
                        
                        const pubDate = item.querySelector('pubDate')?.textContent || new Date().toISOString();
                        
                        // Determinar tipo de noticia basado en palabras clave
                        let tipo = 'general';
                        const tituloLower = titulo.toLowerCase();
                        if (tituloLower.includes('gol') || tituloLower.includes('hat-trick') || tituloLower.includes('triplete')) {
                            tipo = 'gol';
                        } else if (tituloLower.includes('fichaj') || tituloLower.includes('transfer') || tituloLower.includes('refuerzo') || tituloLower.includes('pase')) {
                            tipo = 'transferencia';
                        } else if (tituloLower.includes('lesion') || tituloLower.includes('lesionado') || tituloLower.includes('baja')) {
                            tipo = 'lesion';
                        }
                        
                        noticias.push({
                            id: 'rss_' + Date.now() + '_' + index,
                            tipo: tipo,
                            titulo: titulo,
                            contenido: descripcion || 'Lee m√°s en ' + fuente,
                            fecha: pubDate,
                            fuente: fuente
                        });
                    }
                });
                
                return noticias;
            } catch (error) {
                console.error('Error al parsear RSS:', error);
                return [];
            }
        }

        function obtenerNoticiasEjemplo() {
            // Noticias de ejemplo (fallback si no funciona el RSS)
            return [
                {
                    id: 'f1',
                    tipo: 'general',
                    titulo: 'River gole√≥ a Boca en el Supercl√°sico',
                    contenido: 'El Millonario se impuso 3-0 en el Monumental con goles de Borja, Solari y una joya de tiro libre de Quintero.',
                    fecha: new Date().toISOString(),
                    fuente: 'F√∫tbol Argentino'
                },
                {
                    id: 'f2',
                    tipo: 'transferencia',
                    titulo: 'Oficial: Juli√°n √Ålvarez regresa a River Plate',
                    contenido: 'El delantante campe√≥n del mundo firm√≥ su vuelta al club de N√∫√±ez tras su exitoso paso por el Manchester City.',
                    fecha: new Date().toISOString(),
                    fuente: 'F√∫tbol Argentino'
                },
                {
                    id: 'f3',
                    tipo: 'general',
                    titulo: 'La Selecci√≥n Argentina convoc√≥ 30 jugadores',
                    contenido: 'Scaloni dio la lista preliminar para los pr√≥ximos amistosos de la Albiceleste ante Uruguay y Brasil.',
                    fecha: new Date().toISOString(),
                    fuente: 'Selecci√≥n'
                },
                {
                    id: 'f4',
                    tipo: 'gol',
                    titulo: 'Messi anot√≥ un golazo de tiro libre en Miami',
                    contenido: 'El capit√°n argentino marc√≥ un gol de tiro libre desde 30 metros en la victoria del Inter Miami por 2-1.',
                    fecha: new Date().toISOString(),
                    fuente: 'F√∫tbol Internacional'
                }
            ];
        }

        function mostrarNoticiaActual() {
            if (todasLasNoticias.length === 0) return;
            
            const noticia = todasLasNoticias[noticiaActualIndex];
            const container = document.getElementById('noticias-carrusel');
            
            const iconos = {
                transferencia: 'üîÑ',
                gol: '‚öΩ',
                lesion: 'üè•',
                general: 'üì¢'
            };
            
            const colores = {
                transferencia: 'border-blue-500',
                gol: 'border-green-500',
                lesion: 'border-red-500',
                general: 'border-yellow-500'
            };
            
            const fecha = new Date(noticia.fecha);
            const fechaFormateada = fecha.toLocaleDateString('es-AR', { 
                day: '2-digit', 
                month: 'long', 
                year: 'numeric',
                hour: '2-digit',
                minute: '2-digit'
            });
            
            // Badge seg√∫n origen
            let badge = '';
            if (noticia.origen === 'torneo') {
                badge = '<span class="bg-green-500 text-black px-3 py-1 rounded-full text-xs font-bold uppercase">Los Pibes 6+6</span>';
            } else {
                const fuenteTexto = noticia.fuente || 'F√∫tbol Mundial';
                badge = `<span class="bg-slate-500 text-white px-3 py-1 rounded-full text-xs font-bold uppercase">${fuenteTexto}</span>`;
            }
            
            // Imagen si existe
            let imagenHTML = '';
            if (noticia.imagen && noticia.imagen.trim() !== '') {
                console.log('=== RENDERIZANDO IMAGEN ===');
                console.log('URL:', noticia.imagen);
                console.log('T√≠tulo noticia:', noticia.titulo);
                
                imagenHTML = `
                    <img src="${noticia.imagen}" style="width:100%;max-width:100%;height:auto;display:block;margin:10px 0;">
                `;
            } else {
                console.log('Sin imagen para esta noticia');
            }
            
            // Aplicar fade out
            container.style.opacity = '0';
            
            setTimeout(() => {
                container.innerHTML = `
                    <div class="glass rounded-xl sm:rounded-2xl p-4 sm:p-6 border-l-4 ${colores[noticia.tipo]}">
                        <div class="flex items-start gap-3 mb-3">
                            <div class="text-3xl sm:text-4xl">${iconos[noticia.tipo]}</div>
                            <div class="flex-1">
                                <div class="mb-2">${badge}</div>
                                <h3 class="text-lg sm:text-2xl font-bold text-white mb-3">${noticia.titulo}</h3>
                            </div>
                        </div>
                        ${imagenHTML}
                        <p class="text-sm sm:text-base text-slate-300 mb-3 leading-relaxed">${noticia.contenido}</p>
                        <p class="text-xs text-slate-500 uppercase tracking-wide">${fechaFormateada}</p>
                    </div>
                `;
                
                // Aplicar fade in
                container.style.opacity = '1';
                
                // Actualizar indicador
                document.getElementById('noticia-indicador').textContent = `${noticiaActualIndex + 1} / ${todasLasNoticias.length}`;
            }, 300);
        }

        function iniciarCarruselAutomatico() {
            // Limpiar intervalo anterior si existe
            if (carruselInterval) {
                clearInterval(carruselInterval);
            }
            
            // Cambiar noticia cada 7 segundos
            carruselInterval = setInterval(() => {
                noticiaSiguiente();
            }, 7000);
        }

        function noticiaSiguiente() {
            if (todasLasNoticias.length === 0) return;
            noticiaActualIndex = (noticiaActualIndex + 1) % todasLasNoticias.length;
            mostrarNoticiaActual();
        }

        function noticiaAnterior() {
            if (todasLasNoticias.length === 0) return;
            noticiaActualIndex = (noticiaActualIndex - 1 + todasLasNoticias.length) % todasLasNoticias.length;
            mostrarNoticiaActual();
        }

        async function mostrarDebugNoticias() {
            try {
                const response = await fetch(API_URL + '?accion=obtenerNoticias&t=' + new Date().getTime());
                const noticiasLocales = await response.json();
                
                let info = `üêõ DEBUG DE NOTICIAS\n\n`;
                info += `üìä NOTICIAS LOCALES (Google Sheets): ${Array.isArray(noticiasLocales) ? noticiasLocales.length : 0}\n\n`;
                
                if (Array.isArray(noticiasLocales)) {
                    noticiasLocales.forEach((n, i) => {
                        info += `--- Local ${i + 1} ---\n`;
                        info += `Tipo: ${n.tipo}\n`;
                        info += `T√≠tulo: ${n.titulo ? n.titulo.substring(0, 40) : 'Sin t√≠tulo'}\n`;
                        info += `Tiene imagen: ${n.imagen && n.imagen.trim() !== '' ? 'S√ç (Base64)' : 'NO'}\n\n`;
                    });
                }
                
                info += `\nüì∞ CARRUSEL ACTUAL: ${todasLasNoticias.length} noticias\n\n`;
                
                todasLasNoticias.forEach((n, i) => {
                    const imgStatus = (n.imagen && n.imagen.trim() !== '') ? 'üñºÔ∏è' : 'üìÑ';
                    info += `${i + 1}. ${imgStatus} ${n.titulo ? n.titulo.substring(0, 35) : 'Sin t√≠tulo'}... [${n.origen}]\n`;
                });
                
                alert(info);
                
                // Tambi√©n mostrar en consola para m√°s detalles
                console.log('=== NOTICIAS LOCALES (Sheets) ===', noticiasLocales);
                console.log('=== TODAS LAS NOTICIAS ===', todasLasNoticias);
            } catch (error) {
                alert('‚ùå Error obteniendo debug:\n' + error.message);
            }
        }

        // Funciones del carrusel de fotos
        function comentarioSiguiente() {
            if (todosLosComentarios.length === 0) return;
            
            // Solo navegar entre comentarios principales (no respuestas)
            const comentariosPrincipales = todosLosComentarios.filter(c => !c.parent_id || c.parent_id == 0);
            
            if (comentariosPrincipales.length === 0) return;
            
            const comentarioActual = todosLosComentarios[comentarioActualIndex];
            const indexActualEnPrincipales = comentariosPrincipales.findIndex(c => c.id == comentarioActual.id);
            
            const siguienteIndexPrincipal = (indexActualEnPrincipales + 1) % comentariosPrincipales.length;
            const siguienteComentario = comentariosPrincipales[siguienteIndexPrincipal];
            
            comentarioActualIndex = todosLosComentarios.findIndex(c => c.id == siguienteComentario.id);
            mostrarComentarioActual();
        }

        function comentarioAnterior() {
            if (todosLosComentarios.length === 0) return;
            
            // Solo navegar entre comentarios principales (no respuestas)
            const comentariosPrincipales = todosLosComentarios.filter(c => !c.parent_id || c.parent_id == 0);
            
            if (comentariosPrincipales.length === 0) return;
            
            const comentarioActual = todosLosComentarios[comentarioActualIndex];
            const indexActualEnPrincipales = comentariosPrincipales.findIndex(c => c.id == comentarioActual.id);
            
            const anteriorIndexPrincipal = (indexActualEnPrincipales - 1 + comentariosPrincipales.length) % comentariosPrincipales.length;
            const anteriorComentario = comentariosPrincipales[anteriorIndexPrincipal];
            
            comentarioActualIndex = todosLosComentarios.findIndex(c => c.id == anteriorComentario.id);
            mostrarComentarioActual();
        }

        let comentarioRespondiendo = null;

        async function enviarComentario() {
            const nombre = document.getElementById('nombre-comentario').value.trim();
            const texto = document.getElementById('texto-comentario').value.trim();
            
            if (!nombre) {
                alert('‚ùå Por favor ingresa tu nombre');
                return;
            }
            
            if (!texto) {
                alert('‚ùå Por favor escribe un comentario');
                return;
            }
            
            try {
                const formData = new URLSearchParams();
                formData.append('accion', 'guardarComentario');
                formData.append('id', Date.now());
                formData.append('autor', nombre);
                formData.append('comentario', texto);
                formData.append('fecha', new Date().toISOString());
                formData.append('parent_id', comentarioRespondiendo || 0);
                
                const response = await fetch(API_URL, {
                    method: 'POST',
                    body: formData
                });
                
                const result = await response.json();
                
                if (result.success) {
                    document.getElementById('nombre-comentario').value = '';
                    document.getElementById('texto-comentario').value = '';
                    
                    // Cancelar respuesta
                    comentarioRespondiendo = null;
                    const respuestaLabel = document.getElementById('respondiendo-a');
                    if (respuestaLabel) respuestaLabel.remove();
                    
                    mostrarComentarios();
                    
                    alert('‚úÖ ¬°Comentario publicado!');
                } else {
                    alert('‚ùå Error al guardar: ' + (result.error || 'Error desconocido'));
                }
            } catch (error) {
                console.error('Error enviando comentario:', error);
                alert('‚ùå Error de conexi√≥n al enviar el comentario');
            }
        }

        function responderComentario(id, autor) {
            comentarioRespondiendo = id;
            
            // Mostrar indicador de respuesta
            const formulario = document.querySelector('#nombre-comentario').parentElement;
            let label = document.getElementById('respondiendo-a');
            
            if (!label) {
                label = document.createElement('div');
                label.id = 'respondiendo-a';
                label.className = 'bg-blue-500/20 border border-blue-500 rounded-lg p-2 mb-2 text-xs flex justify-between items-center';
                formulario.insertBefore(label, formulario.firstChild);
            }
            
            label.innerHTML = `
                <span>‚Ü©Ô∏è Respondiendo a <strong>${autor}</strong></span>
                <button onclick="cancelarRespuesta()" class="text-red-400 hover:text-red-300">‚úï</button>
            `;
            
            // Scroll al formulario
            document.getElementById('nombre-comentario').scrollIntoView({ behavior: 'smooth', block: 'center' });
            document.getElementById('texto-comentario').focus();
        }

        function cancelarRespuesta() {
            comentarioRespondiendo = null;
            const label = document.getElementById('respondiendo-a');
            if (label) label.remove();
        }

        async function mostrarComentarios() {
            try {
                const response = await fetch(API_URL + '?accion=obtenerComentarios&t=' + new Date().getTime());
                todosLosComentarios = await response.json();
                
                if (todosLosComentarios.error) {
                    todosLosComentarios = [];
                }
                
                if (!Array.isArray(todosLosComentarios)) {
                    todosLosComentarios = [];
                }
                
                if (todosLosComentarios.length === 0) {
                    document.getElementById('comentarios-carrusel').innerHTML = `
                        <div class="glass rounded-2xl p-8 text-center">
                            <div class="text-6xl mb-4">üí¨</div>
                            <h3 class="text-xl font-bold text-slate-300 mb-2">A√∫n no hay comentarios</h3>
                            <p class="text-slate-400 text-sm">¬°S√© el primero en comentar!</p>
                        </div>
                    `;
                    document.getElementById('comentario-indicador').textContent = '0 / 0';
                    return;
                }
                
                // Ordenar por fecha (m√°s recientes primero)
                todosLosComentarios.sort((a, b) => new Date(b.fecha) - new Date(a.fecha));
                
                comentarioActualIndex = 0;
                mostrarComentarioActual();
                iniciarCarruselComentarios();
            } catch (error) {
                console.error('Error cargando comentarios:', error);
                document.getElementById('comentarios-carrusel').innerHTML = `
                    <div class="glass rounded-2xl p-8 text-center">
                        <div class="text-6xl mb-4">‚ùå</div>
                        <h3 class="text-xl font-bold text-red-400 mb-2">Error cargando comentarios</h3>
                    </div>
                `;
            }
        }

        function mostrarComentarioActual() {
            if (todosLosComentarios.length === 0) return;
            
            const comentarioPrincipal = todosLosComentarios[comentarioActualIndex];
            const container = document.getElementById('comentarios-carrusel');
            
            // Encontrar respuestas a este comentario
            const respuestas = todosLosComentarios.filter(c => c.parent_id == comentarioPrincipal.id);
            
            // Aplicar fade out
            container.style.opacity = '0';
            
            setTimeout(() => {
                let html = renderComentario(comentarioPrincipal, false);
                
                // Agregar respuestas
                if (respuestas.length > 0) {
                    html += '<div class="ml-4 sm:ml-8 mt-3 space-y-3 border-l-2 border-green-500/30 pl-4">';
                    respuestas.forEach(respuesta => {
                        html += renderComentario(respuesta, true);
                    });
                    html += '</div>';
                }
                
                container.innerHTML = html;
                
                // Aplicar fade in
                container.style.opacity = '1';
                
                // Actualizar indicador
                const comentariosPrincipales = todosLosComentarios.filter(c => !c.parent_id || c.parent_id == 0);
                const indexReal = comentariosPrincipales.findIndex(c => c.id == comentarioPrincipal.id);
                document.getElementById('comentario-indicador').textContent = `${indexReal + 1} / ${comentariosPrincipales.length}`;
            }, 300);
        }

        function renderComentario(comentario, esRespuesta) {
            // Manejar fecha
            let fechaFormateada = 'Fecha desconocida';
            if (comentario.fecha) {
                try {
                    const fecha = new Date(comentario.fecha);
                    if (!isNaN(fecha.getTime())) {
                        fechaFormateada = fecha.toLocaleDateString('es-AR', { 
                            day: '2-digit', 
                            month: 'long',
                            hour: '2-digit',
                            minute: '2-digit'
                        });
                    }
                } catch (e) {
                    console.error('Error parseando fecha:', e);
                }
            }
            
            const autor = comentario.autor || 'An√≥nimo';
            const texto = comentario.comentario || 'Sin comentario';
            
            // Reacciones
            const reacciones = comentario.reacciones || {};
            const emojisDisponibles = ['üëç', '‚ù§Ô∏è', 'üî•', '‚öΩ'];
            
            let reaccionesHTML = '<div class="flex gap-2 flex-wrap mt-2">';
            emojisDisponibles.forEach(emoji => {
                const count = reacciones[emoji] || 0;
                reaccionesHTML += `
                    <button onclick="darReaccion(${comentario.id}, '${emoji}')" 
                            class="glass px-2 py-1 rounded-lg hover:bg-white/20 transition-all text-xs flex items-center gap-1">
                        ${emoji} ${count > 0 ? count : ''}
                    </button>
                `;
            });
            reaccionesHTML += '</div>';
            
            const tamano = esRespuesta ? 'text-xs sm:text-sm' : 'text-sm sm:text-base';
            const padding = esRespuesta ? 'p-3' : 'p-4 sm:p-5';
            
            return `
                <div class="glass rounded-xl ${padding} border-l-4 ${esRespuesta ? 'border-blue-500' : 'border-green-500'}">
                    <p class="${tamano} text-white leading-relaxed mb-2 italic">"${texto}"</p>
                    <div class="flex items-start justify-between gap-2">
                        <div class="flex-1">
                            <p class="text-xs font-bold ${esRespuesta ? 'text-blue-400' : 'text-green-400'}">- ${autor}</p>
                            <p class="text-[10px] text-slate-500 uppercase tracking-wide mt-1">${fechaFormateada}</p>
                        </div>
                        <div class="flex gap-2">
                            ${!esRespuesta ? `<button onclick="responderComentario(${comentario.id}, '${autor}')" class="text-blue-400 hover:text-blue-300 text-xs whitespace-nowrap">üí¨ Responder</button>` : ''}
                            ${adminAutenticado ? `<button onclick="eliminarComentario(${comentario.id})" class="text-red-400 hover:text-red-300 text-xs">üóëÔ∏è</button>` : ''}
                        </div>
                    </div>
                    ${reaccionesHTML}
                </div>
            `;
        }

        async function darReaccion(comentarioId, emoji) {
            try {
                const formData = new URLSearchParams();
                formData.append('accion', 'guardarReaccion');
                formData.append('id', comentarioId);
                formData.append('emoji', emoji);
                
                const response = await fetch(API_URL, {
                    method: 'POST',
                    body: formData
                });
                
                const result = await response.json();
                
                if (result.success) {
                    // Actualizar las reacciones localmente
                    const comentario = todosLosComentarios.find(c => c.id == comentarioId);
                    if (comentario) {
                        comentario.reacciones = result.reacciones;
                        mostrarComentarioActual();
                    }
                }
            } catch (error) {
                console.error('Error guardando reacci√≥n:', error);
            }
        }

        function iniciarCarruselComentarios() {
            if (carruselComentariosInterval) {
                clearInterval(carruselComentariosInterval);
            }
            
            if (todosLosComentarios.length > 1) {
                carruselComentariosInterval = setInterval(() => {
                    comentarioSiguiente();
                }, 7000);
            }
        }

        async function eliminarComentario(id) {
            if (!adminAutenticado) {
                alert('‚ùå Solo los administradores pueden eliminar comentarios');
                return;
            }
            
            if (!confirm('¬øEst√°s seguro de eliminar este comentario?')) {
                return;
            }
            
            try {
                const formData = new URLSearchParams();
                formData.append('accion', 'eliminarComentario');
                formData.append('id', id);
                
                const response = await fetch(API_URL, {
                    method: 'POST',
                    body: formData
                });
                
                const result = await response.json();
                
                if (result.success) {
                    mostrarComentarios();
                    alert('‚úÖ Comentario eliminado');
                } else {
                    alert('‚ùå Error al eliminar: ' + (result.error || 'Error desconocido'));
                }
            } catch (error) {
                console.error('Error eliminando comentario:', error);
                alert('‚ùå Error de conexi√≥n al eliminar el comentario');
            }
        }

        async function cargarDatos() {
            const container = document.getElementById('partidos-container');
            container.innerHTML = '<div class="py-10 text-slate-400 italic text-sm">Actualizando resultados...</div>';
            
            try {
                // Fetch con timeout de 10 segundos
                const controller = new AbortController();
                const timeoutId = setTimeout(() => controller.abort(), 10000);
                
                const response = await fetch(API_URL + "?torneo=" + torneoActual + "&t=" + new Date().getTime(), {
                    signal: controller.signal
                });
                clearTimeout(timeoutId);
                
                const datos = await response.json();
                
                if (datos.error) {
                    container.innerHTML = `<div class="p-4 glass rounded-xl text-red-400 font-medium text-sm">${datos.error}</div>`;
                    return;
                }

                datosActuales = datos;
                
                if (vistaActual === 'tabla') {
                    generarTabla();
                } else if (vistaActual === 'goleadores') {
                    cargarGoleadoresLocal();
                } else {
                    mostrarPartidos();
                }
            } catch (error) {
                console.error('Error cargando datos:', error);
                
                if (error.name === 'AbortError') {
                    container.innerHTML = `
                        <div class="p-6 glass rounded-xl text-center">
                            <div class="text-4xl mb-3">‚è±Ô∏è</div>
                            <p class="text-red-400 font-bold mb-2">Tiempo de espera agotado</p>
                            <p class="text-slate-400 text-sm mb-4">No se pudo conectar con Google Sheets</p>
                            <button onclick="cargarDatos()" class="bg-green-500 hover:bg-green-600 px-4 py-2 rounded-lg text-white font-bold">
                                üîÑ Reintentar
                            </button>
                        </div>
                    `;
                } else {
                    container.innerHTML = `
                        <div class="p-6 glass rounded-xl text-center">
                            <div class="text-4xl mb-3">‚ùå</div>
                            <p class="text-red-400 font-bold mb-2">Error de conexi√≥n</p>
                            <p class="text-slate-400 text-sm mb-4">${error.message}</p>
                            <button onclick="cargarDatos()" class="bg-green-500 hover:bg-green-600 px-4 py-2 rounded-lg text-white font-bold">
                                üîÑ Reintentar
                            </button>
                        </div>
                    `;
                }
            }
        }

        function cargarGoleadoresLocal() {
            const container = document.getElementById('goleadores-body');
            container.innerHTML = '<tr><td colspan="4" class="py-10 text-center text-slate-400 italic text-sm">Cargando goleadores...</td></tr>';
            
            // Combinar goles de Apertura y Clausura
            const golesApertura = JSON.parse(localStorage.getItem('goles_Apertura') || '{}');
            const golesClausura = JSON.parse(localStorage.getItem('goles_Clausura') || '{}');
            
            // Objeto para agrupar goles por jugador
            const jugadoresMap = {};
            
            // Funci√≥n para procesar goles
            const procesarGoles = (golesTemp) => {
                Object.keys(golesTemp).forEach(key => {
                    const [equipo, nombre] = key.split('|');
                    const goles = golesTemp[key];
                    
                    if (!jugadoresMap[nombre]) {
                        jugadoresMap[nombre] = {
                            nombre: nombre,
                            golesTotal: 0,
                            equipos: {}
                        };
                    }
                    
                    // Sumar goles por equipo
                    if (!jugadoresMap[nombre].equipos[equipo]) {
                        jugadoresMap[nombre].equipos[equipo] = 0;
                    }
                    jugadoresMap[nombre].equipos[equipo] += goles;
                    jugadoresMap[nombre].golesTotal += goles;
                });
            };
            
            // Procesar ambas temporadas
            procesarGoles(golesApertura);
            procesarGoles(golesClausura);
            
            // Convertir a array y ordenar por goles totales
            const goleadoresArray = Object.values(jugadoresMap).sort((a, b) => b.golesTotal - a.golesTotal);
            
            container.innerHTML = "";
            
            if (goleadoresArray.length === 0) {
                container.innerHTML = '<tr><td colspan="4" class="py-10 text-center text-slate-400 italic text-sm">No hay goleadores registrados. Usa el panel de administraci√≥n para cargar datos.</td></tr>';
                return;
            }
            
            goleadoresArray.forEach((goleador, index) => {
                // Determinar equipo principal (donde tiene m√°s goles)
                let equipoPrincipal = "";
                let maxGoles = 0;
                Object.keys(goleador.equipos).forEach(equipo => {
                    if (goleador.equipos[equipo] > maxGoles) {
                        maxGoles = goleador.equipos[equipo];
                        equipoPrincipal = equipo;
                    }
                });
                
                const info = obtenerInfoEquipo(equipoPrincipal);
                
                // Crear detalle de goles por equipo
                let detalleEquipos = "";
                const equiposOrdenados = Object.keys(goleador.equipos).sort();
                
                if (equiposOrdenados.length > 1) {
                    // Si jug√≥ en m√°s de un equipo, mostrar el desglose
                    const desglose = equiposOrdenados.map(equipo => {
                        const infoEq = obtenerInfoEquipo(equipo);
                        return `<span class="${infoEq.clase}">${goleador.equipos[equipo]}</span>`;
                    }).join(' + ');
                    detalleEquipos = `<div class="text-xs text-slate-400 mt-1">(${desglose})</div>`;
                } else {
                    // Si jug√≥ en un solo equipo, no mostrar detalle
                    detalleEquipos = "";
                }
                
                const equipoHTML = info.escudo
                    ? `<div class="flex items-center gap-2">
                        <img src="${info.escudo}" alt="${equipoPrincipal}" class="escudo-equipo">
                        <div>
                            <span class="${info.clase}">${equipoPrincipal}</span>
                            ${detalleEquipos}
                        </div>
                       </div>`
                    : `<div>${equipoPrincipal}${detalleEquipos}</div>`;
                
                container.innerHTML += `
                    <tr class="border-t border-white/5 hover:bg-white/5 transition-colors ${info.bgColor}">
                        <td class="py-2 sm:py-4 px-2 sm:px-4 font-bold text-slate-400 text-xs sm:text-base">${index + 1}</td>
                        <td class="py-2 sm:py-4 px-2 sm:px-4 font-bold text-xs sm:text-lg ${info.clase}">${goleador.nombre}</td>
                        <td class="py-2 sm:py-4 px-2 sm:px-4 text-xs sm:text-base">${equipoHTML}</td>
                        <td class="py-2 sm:py-4 px-2 sm:px-4 text-center font-black text-lg sm:text-2xl text-green-400">${goleador.golesTotal}</td>
                    </tr>
                `;
            });
        }

        function mostrarPartidos() {
            const container = document.getElementById('partidos-container');
            container.innerHTML = "";
            
            let partidosMostrar = datosActuales;
            
            if (vistaActual === 'proxima') {
                const partidosPendientes = datosActuales.filter(p => p.GolesL === "" || p.GolesV === "");
                
                if (partidosPendientes.length === 0) {
                    container.innerHTML = '<div class="glass rounded-2xl p-6 text-center text-slate-400 italic text-base sm:text-lg">¬°Torneo finalizado! No hay m√°s fechas pendientes.</div>';
                    return;
                }
                
                const proximaFecha = new Date(partidosPendientes[0].Fecha);
                partidosMostrar = partidosPendientes.filter(p => {
                    const fechaPartido = new Date(p.Fecha);
                    return fechaPartido.getTime() === proximaFecha.getTime();
                });
            }
            
            partidosMostrar.forEach(partido => {
                const infoLocal = obtenerInfoEquipo(partido.Local);
                const infoVisita = obtenerInfoEquipo(partido.Visitante);
                
                const fecha = new Date(partido.Fecha);
                const fechaFormateada = fecha.toLocaleDateString('es-AR', { day: '2-digit', month: '2-digit', year: 'numeric' });

                const equipoLocalHTML = infoLocal.escudo
                    ? `<div class="flex items-center gap-2 sm:gap-3 justify-start">
                        <img src="${infoLocal.escudo}" alt="${partido.Local}" class="escudo-equipo">
                        <div class="text-sm sm:text-2xl font-black uppercase tracking-tight ${infoLocal.clase}">${partido.Local}</div>
                       </div>`
                    : `<div class="text-sm sm:text-2xl font-black uppercase tracking-tight">${partido.Local}</div>`;

                const equipoVisitaHTML = infoVisita.escudo
                    ? `<div class="flex items-center gap-2 sm:gap-3 justify-end">
                        <div class="text-sm sm:text-2xl font-black uppercase tracking-tight ${infoVisita.clase}">${partido.Visitante}</div>
                        <img src="${infoVisita.escudo}" alt="${partido.Visitante}" class="escudo-equipo">
                       </div>`
                    : `<div class="text-sm sm:text-2xl font-black uppercase tracking-tight">${partido.Visitante}</div>`;

                const borderColor = infoLocal.escudo || infoVisita.escudo 
                    ? (infoLocal.escudo ? infoLocal.borderColor : infoVisita.borderColor)
                    : 'border-transparent';

                container.innerHTML += `
                    <div class="glass rounded-xl sm:rounded-2xl p-3 sm:p-6 shadow-xl border-l-4 ${borderColor}">
                        <div class="flex items-center justify-between gap-2 sm:gap-3">
                            <div class="w-[35%]">
                                ${equipoLocalHTML}
                            </div>

                            <div class="w-[30%]">
                                <div class="text-[10px] sm:text-base text-slate-400 font-bold uppercase mb-1 sm:mb-3">${fechaFormateada}</div>
                                <div class="flex items-center justify-center gap-1 sm:gap-3">
                                    <span class="text-2xl sm:text-5xl font-black">${partido.GolesL !== "" ? partido.GolesL : '-'}</span>
                                    <span class="text-[10px] sm:text-base bg-white/10 px-1.5 sm:px-3 py-0.5 sm:py-1.5 rounded text-slate-300 font-bold">VS</span>
                                    <span class="text-2xl sm:text-5xl font-black">${partido.GolesV !== "" ? partido.GolesV : '-'}</span>
                                </div>
                            </div>

                            <div class="w-[35%]">
                                ${equipoVisitaHTML}
                            </div>
                        </div>
                    </div>
                `;
            });
        }

        function generarTabla() {
            const equipos = {};
            
            datosActuales.forEach(partido => {
                const local = partido.Local;
                const visitante = partido.Visitante;
                
                if (!equipos[local]) {
                    equipos[local] = { equipo: local, pj: 0, pg: 0, pe: 0, pp: 0, gf: 0, gc: 0, pts: 0 };
                }
                if (!equipos[visitante]) {
                    equipos[visitante] = { equipo: visitante, pj: 0, pg: 0, pe: 0, pp: 0, gf: 0, gc: 0, pts: 0 };
                }
            });
            
            datosActuales.forEach(partido => {
                if (partido.GolesL === "" || partido.GolesV === "") return;
                
                const local = partido.Local;
                const visitante = partido.Visitante;
                const golesL = parseInt(partido.GolesL);
                const golesV = parseInt(partido.GolesV);
                
                equipos[local].pj++;
                equipos[visitante].pj++;
                equipos[local].gf += golesL;
                equipos[local].gc += golesV;
                equipos[visitante].gf += golesV;
                equipos[visitante].gc += golesL;
                
                if (golesL > golesV) {
                    equipos[local].pg++;
                    equipos[local].pts += 3;
                    equipos[visitante].pp++;
                } else if (golesL < golesV) {
                    equipos[visitante].pg++;
                    equipos[visitante].pts += 3;
                    equipos[local].pp++;
                } else {
                    equipos[local].pe++;
                    equipos[visitante].pe++;
                    equipos[local].pts++;
                    equipos[visitante].pts++;
                }
            });
            
            const tablaOrdenada = Object.values(equipos).sort((a, b) => {
                const difA = a.gf - a.gc;
                const difB = b.gf - b.gc;
                
                if (b.pts !== a.pts) return b.pts - a.pts;
                if (difB !== difA) return difB - difA;
                return b.gf - a.gf;
            });
            
            const tbody = document.getElementById('tabla-body');
            tbody.innerHTML = "";
            
            tablaOrdenada.forEach((equipo, index) => {
                const info = obtenerInfoEquipo(equipo.equipo);
                const dif = equipo.gf - equipo.gc;
                const difColor = dif > 0 ? 'text-green-400' : dif < 0 ? 'text-red-400' : 'text-slate-400';
                
                const equipoHTML = info.escudo
                    ? `<div class="flex items-center gap-2">
                        <img src="${info.escudo}" alt="${equipo.equipo}" class="escudo-equipo">
                        <span class="${info.clase}">${equipo.equipo}</span>
                       </div>`
                    : equipo.equipo;
                
                tbody.innerHTML += `
                    <tr class="border-t border-white/5 hover:bg-white/5 transition-colors ${info.bgColor}">
                        <td class="py-2 sm:py-4 px-2 sm:px-4 font-bold text-slate-400 text-xs sm:text-base">${index + 1}</td>
                        <td class="py-2 sm:py-4 px-2 sm:px-4 font-bold text-xs sm:text-lg">${equipoHTML}</td>
                        <td class="py-2 sm:py-4 px-1 sm:px-3 text-center text-slate-400 text-xs sm:text-base">${equipo.pj}</td>
                        <td class="py-2 sm:py-4 px-1 sm:px-3 text-center text-green-400 text-xs sm:text-base">${equipo.pg}</td>
                        <td class="py-2 sm:py-4 px-1 sm:px-3 text-center text-slate-400 text-xs sm:text-base">${equipo.pe}</td>
                        <td class="py-2 sm:py-4 px-1 sm:px-3 text-center text-red-400 text-xs sm:text-base">${equipo.pp}</td>
                        <td class="py-2 sm:py-4 px-1 sm:px-3 text-center text-xs sm:text-base">${equipo.gf}</td>
                        <td class="py-2 sm:py-4 px-1 sm:px-3 text-center text-xs sm:text-base">${equipo.gc}</td>
                        <td class="py-2 sm:py-4 px-1 sm:px-3 text-center font-bold text-xs sm:text-base ${difColor}">${dif > 0 ? '+' : ''}${dif}</td>
                        <td class="py-2 sm:py-4 px-1 sm:px-3 text-center font-black text-lg sm:text-2xl">${equipo.pts}</td>
                    </tr>
                `;
            });
        }

        // Funci√≥n para descargar la tabla de posiciones
        async function descargarTabla() {
            const elemento = document.getElementById('tabla-captura');
            const boton = event.target.closest('button');
            
            // Deshabilitar el bot√≥n y mostrar estado de carga
            boton.disabled = true;
            boton.innerHTML = '<span class="animate-pulse">Generando imagen...</span>';
            
            try {
                const canvas = await html2canvas(elemento, {
                    backgroundColor: '#020617',
                    scale: 2,
                    logging: false,
                    useCORS: true,
                    allowTaint: true
                });
                
                // Convertir a JPG
                canvas.toBlob(function(blob) {
                    const url = URL.createObjectURL(blob);
                    const link = document.createElement('a');
                    const fecha = new Date().toISOString().split('T')[0];
                    link.download = `LOS_PIBES_6+6_Tabla_${torneoActual}_${fecha}.jpg`;
                    link.href = url;
                    link.click();
                    URL.revokeObjectURL(url);
                    
                    // Restaurar el bot√≥n
                    boton.disabled = false;
                    boton.innerHTML = `
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor">
                            <path fill-rule="evenodd" d="M3 17a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zm3.293-7.707a1 1 0 011.414 0L9 10.586V3a1 1 0 112 0v7.586l1.293-1.293a1 1 0 111.414 1.414l-3 3a1 1 0 01-1.414 0l-3-3a1 1 0 010-1.414z" clip-rule="evenodd" />
                        </svg>
                        Descargar JPG
                    `;
                }, 'image/jpeg', 0.95);
                
            } catch (error) {
                console.error('Error al generar la imagen:', error);
                alert('Error al generar la imagen. Por favor intenta nuevamente.');
                
                // Restaurar el bot√≥n
                boton.disabled = false;
                boton.innerHTML = `
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor">
                        <path fill-rule="evenodd" d="M3 17a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zm3.293-7.707a1 1 0 011.414 0L9 10.586V3a1 1 0 112 0v7.586l1.293-1.293a1 1 0 111.414 1.414l-3 3a1 1 0 01-1.414 0l-3-3a1 1 0 010-1.414z" clip-rule="evenodd" />
                    </svg>
                    Descargar JPG
                `;
            }
        }

        // Funci√≥n para descargar la tabla de goleadores
        async function descargarGoleadores() {
            const elemento = document.getElementById('goleadores-captura');
            const boton = event.target.closest('button');
            
            // Deshabilitar el bot√≥n y mostrar estado de carga
            boton.disabled = true;
            boton.innerHTML = '<span class="animate-pulse">Generando imagen...</span>';
            
            try {
                const canvas = await html2canvas(elemento, {
                    backgroundColor: '#020617',
                    scale: 2,
                    logging: false,
                    useCORS: true,
                    allowTaint: true
                });
                
                // Convertir a JPG
                canvas.toBlob(function(blob) {
                    const url = URL.createObjectURL(blob);
                    const link = document.createElement('a');
                    const fecha = new Date().toISOString().split('T')[0];
                    link.download = `LOS_PIBES_6+6_Goleadores_${fecha}.jpg`;
                    link.href = url;
                    link.click();
                    URL.revokeObjectURL(url);
                    
                    // Restaurar el bot√≥n
                    boton.disabled = false;
                    boton.innerHTML = `
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor">
                            <path fill-rule="evenodd" d="M3 17a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zm3.293-7.707a1 1 0 011.414 0L9 10.586V3a1 1 0 112 0v7.586l1.293-1.293a1 1 0 111.414 1.414l-3 3a1 1 0 01-1.414 0l-3-3a1 1 0 010-1.414z" clip-rule="evenodd" />
                        </svg>
                        Descargar JPG
                    `;
                }, 'image/jpeg', 0.95);
                
            } catch (error) {
                console.error('Error al generar la imagen:', error);
                alert('Error al generar la imagen. Por favor intenta nuevamente.');
                
                // Restaurar el bot√≥n
                boton.disabled = false;
                boton.innerHTML = `
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor">
                        <path fill-rule="evenodd" d="M3 17a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zm3.293-7.707a1 1 0 011.414 0L9 10.586V3a1 1 0 112 0v7.586l1.293-1.293a1 1 0 111.414 1.414l-3 3a1 1 0 01-1.414 0l-3-3a1 1 0 010-1.414z" clip-rule="evenodd" />
                    </svg>
                    Descargar JPG
                `;
            }
        }

        // Inicializar con goleadores (no necesita Google Sheets)
        cambiarTorneo('Apertura');
        cambiarVista('goleadores'); // Empezar en goleadores para evitar bloqueo
        
        // Cargar jugadores y noticias
        cargarJugadoresCustom();
        mostrarNoticias();
        mostrarComentarios(); // Cargar comentarios
        
        // Despu√©s de que todo carg√≥, cambiar a pr√≥xima fecha
        setTimeout(() => {
            cambiarVista('proxima');
        }, 500);
        
        // Preview de imagen al seleccionar archivo
        setTimeout(() => {
            const inputImagen = document.getElementById('imagen-noticia');
            if (inputImagen) {
                inputImagen.addEventListener('change', function(e) {
                    const file = e.target.files[0];
                    if (file) {
                        const reader = new FileReader();
                        reader.onload = function(event) {
                            const previewImg = document.getElementById('preview-img');
                            const previewDiv = document.getElementById('preview-imagen');
                            if (previewImg && previewDiv) {
                                previewImg.src = event.target.result;
                                previewDiv.classList.remove('hidden');
                            }
                        };
                        reader.readAsDataURL(file);
                    }
                });
            }
        }, 1000);
    </script>
</body>
</html>
