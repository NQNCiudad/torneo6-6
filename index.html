<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Los Pibes 6+6 | Oficial</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/html2canvas@1.4.1/dist/html2canvas.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Oswald:wght@700&family=Inter:wght@400;700;900&display=swap" rel="stylesheet">
    <style>
        body { 
            font-family: 'Inter', sans-serif; 
            background-color: #020617; 
            color: white;
            margin: 0;
            padding: 0;
        }
        .hero-bg {
            background: linear-gradient(to bottom, rgba(2, 6, 23, 0.6), rgba(2, 6, 23, 0.95)), 
                        url('https://images.unsplash.com/photo-1574629810360-7efbbe195018?q=80&w=2000&auto=format&fit=crop');
            background-size: cover; 
            background-position: center center; 
            background-attachment: fixed; 
            min-height: 100vh;
        }
        .glass { 
            background: rgba(255, 255, 255, 0.05); 
            backdrop-filter: blur(12px); 
            border: 1px solid rgba(255, 255, 255, 0.1); 
            transition: all 0.3s ease; 
        }
        .glass:hover { border-color: #22c55e; transform: translateY(-2px); }
        .vastago-highlight { color: #22c55e; text-shadow: 0 0 10px rgba(34, 197, 94, 0.4); }
        .nacional-highlight { color: #3b82f6; text-shadow: 0 0 10px rgba(59, 130, 246, 0.4); }
        .btn-activo { background: #22c55e; box-shadow: 0 0 20px rgba(34, 197, 94, 0.3); }
        .escudo-equipo { width: 56px; height: 56px; object-fit: contain; }
        
        .btn-descargar {
            background: linear-gradient(135deg, #22c55e 0%, #16a34a 100%);
            box-shadow: 0 4px 15px rgba(34, 197, 94, 0.3);
            transition: all 0.3s ease;
        }
        .btn-descargar:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(34, 197, 94, 0.4);
        }
        
        .btn-admin {
            background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%);
            box-shadow: 0 4px 15px rgba(239, 68, 68, 0.3);
            transition: all 0.3s ease;
        }
        .btn-admin:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(239, 68, 68, 0.4);
        }
        
        .input-goles {
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
            color: white;
            padding: 8px 12px;
            border-radius: 8px;
            width: 80px;
            text-align: center;
            font-weight: bold;
            font-size: 16px;
        }
        .input-goles:focus {
            outline: none;
            border-color: #22c55e;
            background: rgba(255, 255, 255, 0.15);
        }
        
        select.input-goles {
            cursor: pointer;
        }
        select.input-goles option {
            background: #1e293b;
            color: #ffffff;
            font-weight: bold;
        }
        select.input-goles:not(:focus) {
            color: white;
        }
        
        /* Mobile optimization */
        @media (max-width: 640px) {
            .hero-bg {
                background: linear-gradient(to bottom, rgba(2, 6, 23, 0.7), rgba(2, 6, 23, 0.95)), 
                            url('https://images.unsplash.com/photo-1574629810360-7efbbe195018?q=80&w=2000&auto=format&fit=crop');
                background-size: cover;
                background-position: center center;
                background-attachment: scroll;
            }
            .escudo-equipo { width: 40px; height: 40px; }
            .input-goles { width: 60px; font-size: 14px; }
        }
        
        /* Landscape mobile */
        @media (max-width: 900px) and (orientation: landscape) {
            .hero-bg {
                background-position: center center;
            }
        }
        
        /* Tablets portrait */
        @media (min-width: 641px) and (max-width: 1024px) and (orientation: portrait) {
            .hero-bg {
                background-position: center center;
            }
        }
    </style>
</head>
<body class="hero-bg">
    <div class="max-w-5xl mx-auto px-3 sm:px-4 py-4 sm:py-12">
        <header class="text-center mb-6 sm:mb-12">
            <h1 class="text-3xl sm:text-6xl font-black italic uppercase tracking-tighter leading-none" style="font-family: 'Oswald';">
                LOS PIBES <span class="text-green-500">6+6</span>
            </h1>
            <p class="text-slate-400 tracking-[0.2em] sm:tracking-[0.3em] uppercase text-[8px] sm:text-[10px] mt-2 sm:mt-4 font-bold">TEMPORADA 2026 | Torneo Los Pibes 6+6</p>
        </header>

        <!-- Bot√≥n Admin (esquina superior derecha) -->
        <div class="fixed top-4 right-4 z-50">
            <button onclick="toggleAdmin()" class="btn-admin px-3 sm:px-4 py-2 sm:py-3 rounded-xl font-bold text-xs sm:text-sm text-white">
                üîê ADMIN
            </button>
        </div>

        <!-- Panel de Administraci√≥n -->
        <div id="admin-panel" class="hidden mb-6 glass rounded-2xl p-4 sm:p-6 border-2 border-red-500">
            <div class="flex justify-between items-center mb-4">
                <h2 class="text-xl sm:text-2xl font-bold text-red-400">Panel de Administraci√≥n</h2>
                <button onclick="toggleAdmin()" class="text-red-400 hover:text-red-300 text-2xl">&times;</button>
            </div>
            
            <div class="mb-4">
                <label class="text-sm font-bold text-slate-300 mb-2 block">Contrase√±a Admin:</label>
                <input type="password" id="admin-password" class="input-goles w-full max-w-xs" placeholder="Ingresa contrase√±a">
                <button onclick="verificarPassword()" class="ml-2 bg-green-500 hover:bg-green-600 px-4 py-2 rounded-lg font-bold text-sm">
                    Acceder
                </button>
            </div>

            <div id="admin-content" class="hidden">
                <!-- Selector de Temporada -->
                <div class="mb-6">
                    <label class="text-sm font-bold text-slate-300 mb-2 block">Temporada:</label>
                    <div class="flex gap-2 mb-4">
                        <button onclick="cambiarTemporadaAdmin('Apertura')" id="btn-temp-Apertura" class="px-6 py-2 rounded-xl font-bold text-sm transition-all bg-white/10 hover:bg-white/20">Apertura</button>
                        <button onclick="cambiarTemporadaAdmin('Clausura')" id="btn-temp-Clausura" class="px-6 py-2 rounded-xl font-bold text-sm transition-all bg-white/10 hover:bg-white/20">Clausura</button>
                    </div>
                </div>

                <!-- Lista de Jugadores -->
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4" id="admin-jugadores">
                    <!-- Se llena din√°micamente -->
                </div>

                <div class="mt-6 flex gap-3">
                    <button onclick="guardarGoles()" class="bg-green-500 hover:bg-green-600 px-6 py-3 rounded-xl font-bold text-sm flex-1">
                        üíæ Guardar Cambios
                    </button>
                    <button onclick="resetearGoles()" class="bg-red-500 hover:bg-red-600 px-6 py-3 rounded-xl font-bold text-sm">
                        üóëÔ∏è Resetear
                    </button>
                </div>

                <!-- Agregar Jugador Nuevo -->
                <div class="mt-6 glass rounded-xl p-4 border border-yellow-500">
                    <h3 class="font-bold text-yellow-400 mb-3 flex items-center gap-2">
                        <span class="text-xl">‚ûï</span> Agregar Jugador Invitado
                    </h3>
                    <div class="grid grid-cols-1 sm:grid-cols-3 gap-3">
                        <input type="text" id="nuevo-jugador-nombre" class="input-goles w-full" placeholder='Nombre completo (ej: Juan "El Tigre" P√©rez)'>
                        <select id="nuevo-jugador-equipo" class="input-goles w-full">
                            <option value="">Selecciona equipo...</option>
                            <option value="V√°stago F.C.">V√°stago F.C.</option>
                            <option value="Nacional F.C.">Nacional F.C.</option>
                        </select>
                        <button onclick="agregarJugadorNuevo()" class="bg-yellow-500 hover:bg-yellow-600 px-4 py-2 rounded-xl font-bold text-sm text-black">
                            ‚ûï Agregar
                        </button>
                    </div>
                    <p class="text-xs text-slate-400 mt-2">Los jugadores invitados se guardan autom√°ticamente y aparecer√°n en la lista.</p>
                </div>
            </div>
        </div>

        <!-- Selector de Torneo -->
        <div class="flex justify-center mb-3 sm:mb-6 bg-white/5 p-1 rounded-2xl w-fit mx-auto border border-white/10">
            <button onclick="cambiarTorneo('Apertura')" id="btn-torneo-Apertura" class="px-6 sm:px-8 py-2 sm:py-3 rounded-xl font-bold text-sm sm:text-base transition-all">Apertura</button>
            <button onclick="cambiarTorneo('Clausura')" id="btn-torneo-Clausura" class="px-6 sm:px-8 py-2 sm:py-3 rounded-xl font-bold text-sm sm:text-base transition-all">Clausura</button>
        </div>

        <!-- Selector de Vista Principal -->
        <div class="flex flex-wrap justify-center gap-1 sm:gap-2 mb-4 sm:mb-10 bg-white/5 p-1 rounded-2xl w-fit mx-auto border border-white/10 max-w-[95vw]">
            <button onclick="cambiarVista('proxima')" id="btn-vista-proxima" class="px-2 sm:px-5 py-2 sm:py-3 rounded-xl font-bold text-[10px] sm:text-base transition-all whitespace-nowrap">Pr√≥xima Fecha</button>
            <button onclick="cambiarVista('tabla')" id="btn-vista-tabla" class="px-3 sm:px-5 py-2 sm:py-3 rounded-xl font-bold text-[10px] sm:text-base transition-all">Tabla</button>
            <button onclick="cambiarVista('fixture')" id="btn-vista-fixture" class="px-3 sm:px-5 py-2 sm:py-3 rounded-xl font-bold text-[10px] sm:text-base transition-all">Fixture</button>
            <button onclick="cambiarVista('goleadores')" id="btn-vista-goleadores" class="px-2 sm:px-5 py-2 sm:py-3 rounded-xl font-bold text-[10px] sm:text-base transition-all">Goleadores</button>
        </div>

        <!-- Contenedor de Fixture/Pr√≥xima Fecha -->
        <div id="partidos-container" class="space-y-3 sm:space-y-5 text-center">
            <div class="animate-pulse text-slate-500 text-xs sm:text-sm italic font-medium tracking-widest">Sincronizando con planilla...</div>
        </div>

        <!-- Contenedor de Tabla -->
        <div id="tabla-container" class="hidden">
            <!-- Bot√≥n de descarga -->
            <div class="flex justify-end mb-3">
                <button onclick="descargarTabla()" class="btn-descargar px-4 sm:px-6 py-2 sm:py-3 rounded-xl font-bold text-sm sm:text-base text-white flex items-center gap-2">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor">
                        <path fill-rule="evenodd" d="M3 17a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zm3.293-7.707a1 1 0 011.414 0L9 10.586V3a1 1 0 112 0v7.586l1.293-1.293a1 1 0 111.414 1.414l-3 3a1 1 0 01-1.414 0l-3-3a1 1 0 010-1.414z" clip-rule="evenodd" />
                    </svg>
                    Descargar JPG
                </button>
            </div>
            
            <div id="tabla-captura" style="background: linear-gradient(to bottom, rgba(2, 6, 23, 0.85), rgba(2, 6, 23, 0.95)), url('https://images.unsplash.com/photo-1574629810360-7efbbe195018?q=80&w=2000&auto=format&fit=crop'); background-size: cover; background-position: center;" class="rounded-xl sm:rounded-2xl p-6 sm:p-8">
                <!-- Encabezado de la imagen -->
                <div class="text-center mb-6">
                    <h2 class="text-3xl sm:text-5xl font-black italic uppercase tracking-tighter leading-none mb-2" style="font-family: 'Oswald';">
                        LOS PIBES <span class="text-green-500">6+6</span>
                    </h2>
                    <p class="text-slate-300 tracking-[0.2em] uppercase text-xs sm:text-sm font-bold">TABLA DE POSICIONES</p>
                    <p class="text-slate-400 tracking-widest uppercase text-[10px] mt-1 font-bold" id="torneo-nombre-tabla">TORNEO APERTURA 2026</p>
                </div>
                
                <div class="glass rounded-xl sm:rounded-2xl overflow-x-auto">
                    <table class="w-full text-sm sm:text-base">
                        <thead class="bg-white/5">
                            <tr class="text-[10px] sm:text-sm text-slate-400 uppercase tracking-wider">
                                <th class="py-2 sm:py-4 px-2 sm:px-4 text-left">Pos</th>
                                <th class="py-2 sm:py-4 px-2 sm:px-4 text-left">Equipo</th>
                                <th class="py-2 sm:py-4 px-1 sm:px-3 text-center">PJ</th>
                                <th class="py-2 sm:py-4 px-1 sm:px-3 text-center">PG</th>
                                <th class="py-2 sm:py-4 px-1 sm:px-3 text-center">PE</th>
                                <th class="py-2 sm:py-4 px-1 sm:px-3 text-center">PP</th>
                                <th class="py-2 sm:py-4 px-1 sm:px-3 text-center">GF</th>
                                <th class="py-2 sm:py-4 px-1 sm:px-3 text-center">GC</th>
                                <th class="py-2 sm:py-4 px-1 sm:px-3 text-center">DIF</th>
                                <th class="py-2 sm:py-4 px-1 sm:px-3 text-center font-bold">PTS</th>
                            </tr>
                        </thead>
                        <tbody id="tabla-body">
                            <!-- Se llena din√°micamente -->
                        </tbody>
                    </table>
                </div>
            </div>
        </div>

        <!-- Contenedor de Goleadores -->
        <div id="goleadores-container" class="hidden">
            <!-- Bot√≥n de descarga -->
            <div class="flex justify-end mb-3">
                <button onclick="descargarGoleadores()" class="btn-descargar px-4 sm:px-6 py-2 sm:py-3 rounded-xl font-bold text-sm sm:text-base text-white flex items-center gap-2">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor">
                        <path fill-rule="evenodd" d="M3 17a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zm3.293-7.707a1 1 0 011.414 0L9 10.586V3a1 1 0 112 0v7.586l1.293-1.293a1 1 0 111.414 1.414l-3 3a1 1 0 01-1.414 0l-3-3a1 1 0 010-1.414z" clip-rule="evenodd" />
                    </svg>
                    Descargar JPG
                </button>
            </div>
            
            <div id="goleadores-captura" style="background: linear-gradient(to bottom, rgba(2, 6, 23, 0.85), rgba(2, 6, 23, 0.95)), url('https://images.unsplash.com/photo-1574629810360-7efbbe195018?q=80&w=2000&auto=format&fit=crop'); background-size: cover; background-position: center;" class="rounded-xl sm:rounded-2xl p-6 sm:p-8">
                <!-- Encabezado de la imagen -->
                <div class="text-center mb-6">
                    <h2 class="text-3xl sm:text-5xl font-black italic uppercase tracking-tighter leading-none mb-2" style="font-family: 'Oswald';">
                        LOS PIBES <span class="text-green-500">6+6</span>
                    </h2>
                    <p class="text-slate-300 tracking-[0.2em] uppercase text-xs sm:text-sm font-bold">TABLA DE GOLEADORES</p>
                    <p class="text-slate-400 tracking-widest uppercase text-[10px] mt-1 font-bold">TEMPORADA 2026</p>
                </div>
                
                <div class="glass rounded-xl sm:rounded-2xl overflow-x-auto">
                    <table class="w-full text-sm sm:text-base">
                        <thead class="bg-white/5">
                            <tr class="text-[10px] sm:text-sm text-slate-400 uppercase tracking-wider">
                                <th class="py-2 sm:py-4 px-2 sm:px-4 text-left">Pos</th>
                                <th class="py-2 sm:py-4 px-2 sm:px-4 text-left">Jugador</th>
                                <th class="py-2 sm:py-4 px-2 sm:px-4 text-left">Equipo</th>
                                <th class="py-2 sm:py-4 px-2 sm:px-4 text-center font-bold">‚öΩ Goles</th>
                            </tr>
                        </thead>
                        <tbody id="goleadores-body">
                            <!-- Se llena din√°micamente -->
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>

    <script>
        const API_URL = "https://script.google.com/macros/s/AKfycbw675NO52ucINehQlIo1xJcHfr7Jd-uAIi6dvhitcB0aApt_5bRBu_2UI_avNwWxdf2/exec";
        const ESCUDO_VASTAGO = "https://nqnciudad.github.io/torneo6-6/imagen/escudo-vastago.png";
        const ESCUDO_NACIONAL = "https://nqnciudad.github.io/torneo6-6/imagen/escudo-nacional.png";
        const ADMIN_PASSWORD = "pibes2026"; // Cambia esto por tu contrase√±a
        
        let torneoActual = 'Apertura';
        let vistaActual = 'proxima';
        let datosActuales = [];
        let temporadaAdmin = 'Apertura';
        let adminAutenticado = false;

        // Base de datos de jugadores
        const jugadoresDB = {
            "V√°stago F.C.": [
                { nombre: "Gabriel 'El Capi' Abas", apodo: "El Capi" },
                { nombre: "Maty 'El Picante' Pereyra", apodo: "El Picante" },
                { nombre: "Chano 'El Buda' Bertoni", apodo: "El Buda" },
                { nombre: "Jona 'El Muro' Cheves", apodo: "El Muro" },
                { nombre: "Christian 'El Rengo' Corti", apodo: "El Rengo" },
                { nombre: "Andy 'El Pela' Soto", apodo: "El Pela" },
                { nombre: "Carlos 'M√°gico' Lucero", apodo: "M√°gico" },
                { nombre: "Pablito 'El Tucu' Figueroa Alcorta", apodo: "El Tucu" },
                { nombre: "Juli√°n 'La Joya' Ib√°√±ez", apodo: "La Joya" },
                { nombre: "Juan 'La Esperanza' De Giorgis", apodo: "La Esperanza" },
                { nombre: "Gabriel 'El Zurdo' Alonso", apodo: "El Zurdo" }
            ],
            "Nacional F.C.": [
                { nombre: "Franco 'Matio' Matievich", apodo: "Matio" },
                { nombre: "Ricardo 'La Chancha' Mendoza", apodo: "La Chancha" },
                { nombre: "Fernando 'Me Lesiono' Dominguez", apodo: "Me Lesiono" },
                { nombre: "Pablo 'Caballo' Jorgensen", apodo: "Caballo" },
                { nombre: "Rodrigo 'Zerafo' Gatti", apodo: "Zerafo" },
                { nombre: "Jose 'Gambeta' Gatica", apodo: "Gambeta" },
                { nombre: "Pedro 'El Barba' Oliver", apodo: "El Barba" },
                { nombre: "Damian 'Damiao' Moller", apodo: "Damiao" },
                { nombre: "Javier 'El Profe' Llarena", apodo: "El Profe" },
                { nombre: "Gerardo 'Cari√±oso' Esperanza", apodo: "Cari√±oso" },
                { nombre: "Andres 'La Tripa' Fern√°ndez", apodo: "La Tripa" }
            ]
        };

        function obtenerInfoEquipo(nombreEquipo) {
            if (nombreEquipo.includes("V√°stago")) {
                return { escudo: ESCUDO_VASTAGO, clase: "vastago-highlight", borderColor: "border-green-500", bgColor: "bg-green-500/5" };
            } else if (nombreEquipo.includes("Nacional")) {
                return { escudo: ESCUDO_NACIONAL, clase: "nacional-highlight", borderColor: "border-blue-500", bgColor: "bg-blue-500/5" };
            }
            return { escudo: null, clase: "", borderColor: "border-transparent", bgColor: "" };
        }

        // Funciones de Admin
        function toggleAdmin() {
            const panel = document.getElementById('admin-panel');
            panel.classList.toggle('hidden');
            if (!panel.classList.contains('hidden') && adminAutenticado) {
                cargarPanelAdmin();
            }
        }

        function verificarPassword() {
            const password = document.getElementById('admin-password').value;
            if (password === ADMIN_PASSWORD) {
                adminAutenticado = true;
                document.getElementById('admin-content').classList.remove('hidden');
                cargarPanelAdmin();
            } else {
                alert('‚ùå Contrase√±a incorrecta');
            }
        }

        function cambiarTemporadaAdmin(temp) {
            temporadaAdmin = temp;
            document.querySelectorAll('[id^="btn-temp-"]').forEach(b => b.classList.remove('btn-activo'));
            document.getElementById('btn-temp-' + temp).classList.add('btn-activo');
            cargarPanelAdmin();
        }

        function cargarPanelAdmin() {
            const container = document.getElementById('admin-jugadores');
            container.innerHTML = '';
            
            const golesGuardados = JSON.parse(localStorage.getItem('goles_' + temporadaAdmin) || '{}');
            
            Object.keys(jugadoresDB).forEach(equipo => {
                const info = obtenerInfoEquipo(equipo);
                
                const equipoDiv = document.createElement('div');
                equipoDiv.className = 'glass rounded-xl p-4 border-l-4 ' + info.borderColor;
                equipoDiv.innerHTML = `
                    <div class="flex items-center gap-2 mb-4">
                        ${info.escudo ? `<img src="${info.escudo}" class="w-10 h-10">` : ''}
                        <h3 class="font-bold text-lg ${info.clase}">${equipo}</h3>
                    </div>
                    <div class="space-y-2">
                        ${jugadoresDB[equipo].map(jugador => {
                            const key = equipo + '|' + jugador.nombre;
                            const goles = golesGuardados[key] || 0;
                            return `
                                <div class="flex justify-between items-center bg-white/5 p-2 rounded-lg">
                                    <span class="text-sm font-medium">${jugador.nombre}</span>
                                    <input type="number" 
                                           class="input-goles" 
                                           id="goles-${key.replace(/[^a-zA-Z0-9]/g, '_')}"
                                           value="${goles}" 
                                           min="0"
                                           data-key="${key}">
                                </div>
                            `;
                        }).join('')}
                    </div>
                `;
                container.appendChild(equipoDiv);
            });
            
            // Activar bot√≥n de temporada
            document.querySelectorAll('[id^="btn-temp-"]').forEach(b => b.classList.remove('btn-activo'));
            document.getElementById('btn-temp-' + temporadaAdmin).classList.add('btn-activo');
        }

        function guardarGoles() {
            const goles = {};
            const inputs = document.querySelectorAll('.input-goles[data-key]');
            
            inputs.forEach(input => {
                const key = input.getAttribute('data-key');
                const valor = parseInt(input.value) || 0;
                if (valor > 0) {
                    goles[key] = valor;
                }
            });
            
            localStorage.setItem('goles_' + temporadaAdmin, JSON.stringify(goles));
            alert('‚úÖ Goles guardados correctamente para ' + temporadaAdmin);
            
            // Recargar goleadores si estamos en esa vista
            if (vistaActual === 'goleadores') {
                cargarGoleadoresLocal();
            }
        }

        function resetearGoles() {
            if (confirm('‚ö†Ô∏è ¬øEst√°s seguro de que quieres resetear TODOS los goles de ' + temporadaAdmin + '?')) {
                localStorage.removeItem('goles_' + temporadaAdmin);
                cargarPanelAdmin();
                alert('‚úÖ Goles reseteados');
            }
        }

        function agregarJugadorNuevo() {
            const nombre = document.getElementById('nuevo-jugador-nombre').value.trim();
            const equipo = document.getElementById('nuevo-jugador-equipo').value;
            
            if (!nombre) {
                alert('‚ùå Por favor ingresa el nombre del jugador');
                return;
            }
            
            if (!equipo) {
                alert('‚ùå Por favor selecciona un equipo');
                return;
            }
            
            // Verificar si el jugador ya existe
            const yaExiste = jugadoresDB[equipo].some(j => j.nombre === nombre);
            if (yaExiste) {
                alert('‚ö†Ô∏è Este jugador ya existe en ' + equipo);
                return;
            }
            
            // Agregar jugador a la base de datos
            jugadoresDB[equipo].push({ nombre: nombre, apodo: "" });
            
            // Guardar jugadores personalizados en localStorage
            const jugadoresCustom = JSON.parse(localStorage.getItem('jugadores_custom') || '{}');
            if (!jugadoresCustom[equipo]) {
                jugadoresCustom[equipo] = [];
            }
            jugadoresCustom[equipo].push({ nombre: nombre, apodo: "" });
            localStorage.setItem('jugadores_custom', JSON.stringify(jugadoresCustom));
            
            // Limpiar campos
            document.getElementById('nuevo-jugador-nombre').value = '';
            document.getElementById('nuevo-jugador-equipo').value = '';
            
            // Recargar panel
            cargarPanelAdmin();
            
            alert('‚úÖ Jugador agregado: ' + nombre + ' ‚Üí ' + equipo);
        }

        function cargarJugadoresCustom() {
            const jugadoresCustom = JSON.parse(localStorage.getItem('jugadores_custom') || '{}');
            
            Object.keys(jugadoresCustom).forEach(equipo => {
                jugadoresCustom[equipo].forEach(jugador => {
                    const yaExiste = jugadoresDB[equipo].some(j => j.nombre === jugador.nombre);
                    if (!yaExiste) {
                        jugadoresDB[equipo].push(jugador);
                    }
                });
            });
        }

        function cambiarTorneo(torneo) {
            torneoActual = torneo;
            document.querySelectorAll('[id^="btn-torneo-"]').forEach(b => b.classList.remove('btn-activo'));
            document.getElementById('btn-torneo-' + torneo).classList.add('btn-activo');
            
            // Actualizar el nombre del torneo en el encabezado de la tabla
            const nombreTorneo = document.getElementById('torneo-nombre-tabla');
            if (nombreTorneo) {
                nombreTorneo.textContent = `TORNEO ${torneo.toUpperCase()} 2026`;
            }
            
            cargarDatos();
        }

        function cambiarVista(vista) {
            vistaActual = vista;
            document.querySelectorAll('[id^="btn-vista-"]').forEach(b => b.classList.remove('btn-activo'));
            document.getElementById('btn-vista-' + vista).classList.add('btn-activo');
            
            document.getElementById('partidos-container').classList.add('hidden');
            document.getElementById('tabla-container').classList.add('hidden');
            document.getElementById('goleadores-container').classList.add('hidden');
            
            if (vista === 'tabla') {
                document.getElementById('tabla-container').classList.remove('hidden');
                generarTabla();
            } else if (vista === 'goleadores') {
                document.getElementById('goleadores-container').classList.remove('hidden');
                cargarGoleadoresLocal();
            } else {
                document.getElementById('partidos-container').classList.remove('hidden');
                mostrarPartidos();
            }
        }

        async function cargarDatos() {
            const container = document.getElementById('partidos-container');
            container.innerHTML = '<div class="py-10 text-slate-400 italic text-sm">Actualizando resultados...</div>';
            
            try {
                const response = await fetch(API_URL + "?torneo=" + torneoActual + "&t=" + new Date().getTime());
                const datos = await response.json();
                
                if (datos.error) {
                    container.innerHTML = `<div class="p-4 glass rounded-xl text-red-400 font-medium text-sm">${datos.error}</div>`;
                    return;
                }

                datosActuales = datos;
                
                if (vistaActual === 'tabla') {
                    generarTabla();
                } else if (vistaActual === 'goleadores') {
                    cargarGoleadoresLocal();
                } else {
                    mostrarPartidos();
                }
            } catch (error) {
                console.error(error);
                container.innerHTML = `<div class="p-4 glass rounded-xl text-red-400 text-sm">Error de conexi√≥n. Revisa la consola (F12).</div>`;
            }
        }

        function cargarGoleadoresLocal() {
            const container = document.getElementById('goleadores-body');
            container.innerHTML = '<tr><td colspan="4" class="py-10 text-center text-slate-400 italic text-sm">Cargando goleadores...</td></tr>';
            
            // Combinar goles de Apertura y Clausura
            const golesApertura = JSON.parse(localStorage.getItem('goles_Apertura') || '{}');
            const golesClausura = JSON.parse(localStorage.getItem('goles_Clausura') || '{}');
            
            const goleadoresArray = [];
            
            // Procesar goles de Apertura
            Object.keys(golesApertura).forEach(key => {
                const [equipo, nombre] = key.split('|');
                goleadoresArray.push({
                    Jugador: nombre,
                    Equipo: equipo,
                    Goles: golesApertura[key]
                });
            });
            
            // Procesar goles de Clausura
            Object.keys(golesClausura).forEach(key => {
                const [equipo, nombre] = key.split('|');
                const existente = goleadoresArray.find(g => g.Jugador === nombre);
                if (existente) {
                    existente.Goles += golesClausura[key];
                } else {
                    goleadoresArray.push({
                        Jugador: nombre,
                        Equipo: equipo,
                        Goles: golesClausura[key]
                    });
                }
            });
            
            // Ordenar por goles
            goleadoresArray.sort((a, b) => b.Goles - a.Goles);
            
            container.innerHTML = "";
            
            if (goleadoresArray.length === 0) {
                container.innerHTML = '<tr><td colspan="4" class="py-10 text-center text-slate-400 italic text-sm">No hay goleadores registrados. Usa el panel de administraci√≥n para cargar datos.</td></tr>';
                return;
            }
            
            goleadoresArray.forEach((goleador, index) => {
                const info = obtenerInfoEquipo(goleador.Equipo);
                
                const equipoHTML = info.escudo
                    ? `<div class="flex items-center gap-2">
                        <img src="${info.escudo}" alt="${goleador.Equipo}" class="escudo-equipo">
                        <span class="${info.clase}">${goleador.Equipo}</span>
                       </div>`
                    : goleador.Equipo;
                
                container.innerHTML += `
                    <tr class="border-t border-white/5 hover:bg-white/5 transition-colors ${info.bgColor}">
                        <td class="py-2 sm:py-4 px-2 sm:px-4 font-bold text-slate-400 text-xs sm:text-base">${index + 1}</td>
                        <td class="py-2 sm:py-4 px-2 sm:px-4 font-bold text-xs sm:text-lg ${info.clase}">${goleador.Jugador}</td>
                        <td class="py-2 sm:py-4 px-2 sm:px-4 text-xs sm:text-base">${equipoHTML}</td>
                        <td class="py-2 sm:py-4 px-2 sm:px-4 text-center font-black text-lg sm:text-2xl text-green-400">${goleador.Goles}</td>
                    </tr>
                `;
            });
        }

        function mostrarPartidos() {
            const container = document.getElementById('partidos-container');
            container.innerHTML = "";
            
            let partidosMostrar = datosActuales;
            
            if (vistaActual === 'proxima') {
                const partidosPendientes = datosActuales.filter(p => p.GolesL === "" || p.GolesV === "");
                
                if (partidosPendientes.length === 0) {
                    container.innerHTML = '<div class="glass rounded-2xl p-6 text-center text-slate-400 italic text-base sm:text-lg">¬°Torneo finalizado! No hay m√°s fechas pendientes.</div>';
                    return;
                }
                
                const proximaFecha = new Date(partidosPendientes[0].Fecha);
                partidosMostrar = partidosPendientes.filter(p => {
                    const fechaPartido = new Date(p.Fecha);
                    return fechaPartido.getTime() === proximaFecha.getTime();
                });
            }
            
            partidosMostrar.forEach(partido => {
                const infoLocal = obtenerInfoEquipo(partido.Local);
                const infoVisita = obtenerInfoEquipo(partido.Visitante);
                
                const fecha = new Date(partido.Fecha);
                const fechaFormateada = fecha.toLocaleDateString('es-AR', { day: '2-digit', month: '2-digit', year: 'numeric' });

                const equipoLocalHTML = infoLocal.escudo
                    ? `<div class="flex items-center gap-2 sm:gap-3 justify-start">
                        <img src="${infoLocal.escudo}" alt="${partido.Local}" class="escudo-equipo">
                        <div class="text-sm sm:text-2xl font-black uppercase tracking-tight ${infoLocal.clase}">${partido.Local}</div>
                       </div>`
                    : `<div class="text-sm sm:text-2xl font-black uppercase tracking-tight">${partido.Local}</div>`;

                const equipoVisitaHTML = infoVisita.escudo
                    ? `<div class="flex items-center gap-2 sm:gap-3 justify-end">
                        <div class="text-sm sm:text-2xl font-black uppercase tracking-tight ${infoVisita.clase}">${partido.Visitante}</div>
                        <img src="${infoVisita.escudo}" alt="${partido.Visitante}" class="escudo-equipo">
                       </div>`
                    : `<div class="text-sm sm:text-2xl font-black uppercase tracking-tight">${partido.Visitante}</div>`;

                const borderColor = infoLocal.escudo || infoVisita.escudo 
                    ? (infoLocal.escudo ? infoLocal.borderColor : infoVisita.borderColor)
                    : 'border-transparent';

                container.innerHTML += `
                    <div class="glass rounded-xl sm:rounded-2xl p-3 sm:p-6 shadow-xl border-l-4 ${borderColor}">
                        <div class="flex items-center justify-between gap-2 sm:gap-3">
                            <div class="w-[35%]">
                                ${equipoLocalHTML}
                            </div>

                            <div class="w-[30%]">
                                <div class="text-[10px] sm:text-base text-slate-400 font-bold uppercase mb-1 sm:mb-3">${fechaFormateada}</div>
                                <div class="flex items-center justify-center gap-1 sm:gap-3">
                                    <span class="text-2xl sm:text-5xl font-black">${partido.GolesL !== "" ? partido.GolesL : '-'}</span>
                                    <span class="text-[10px] sm:text-base bg-white/10 px-1.5 sm:px-3 py-0.5 sm:py-1.5 rounded text-slate-300 font-bold">VS</span>
                                    <span class="text-2xl sm:text-5xl font-black">${partido.GolesV !== "" ? partido.GolesV : '-'}</span>
                                </div>
                            </div>

                            <div class="w-[35%]">
                                ${equipoVisitaHTML}
                            </div>
                        </div>
                    </div>
                `;
            });
        }

        function generarTabla() {
            const equipos = {};
            
            datosActuales.forEach(partido => {
                const local = partido.Local;
                const visitante = partido.Visitante;
                
                if (!equipos[local]) {
                    equipos[local] = { equipo: local, pj: 0, pg: 0, pe: 0, pp: 0, gf: 0, gc: 0, pts: 0 };
                }
                if (!equipos[visitante]) {
                    equipos[visitante] = { equipo: visitante, pj: 0, pg: 0, pe: 0, pp: 0, gf: 0, gc: 0, pts: 0 };
                }
            });
            
            datosActuales.forEach(partido => {
                if (partido.GolesL === "" || partido.GolesV === "") return;
                
                const local = partido.Local;
                const visitante = partido.Visitante;
                const golesL = parseInt(partido.GolesL);
                const golesV = parseInt(partido.GolesV);
                
                equipos[local].pj++;
                equipos[visitante].pj++;
                equipos[local].gf += golesL;
                equipos[local].gc += golesV;
                equipos[visitante].gf += golesV;
                equipos[visitante].gc += golesL;
                
                if (golesL > golesV) {
                    equipos[local].pg++;
                    equipos[local].pts += 3;
                    equipos[visitante].pp++;
                } else if (golesL < golesV) {
                    equipos[visitante].pg++;
                    equipos[visitante].pts += 3;
                    equipos[local].pp++;
                } else {
                    equipos[local].pe++;
                    equipos[visitante].pe++;
                    equipos[local].pts++;
                    equipos[visitante].pts++;
                }
            });
            
            const tablaOrdenada = Object.values(equipos).sort((a, b) => {
                const difA = a.gf - a.gc;
                const difB = b.gf - b.gc;
                
                if (b.pts !== a.pts) return b.pts - a.pts;
                if (difB !== difA) return difB - difA;
                return b.gf - a.gf;
            });
            
            const tbody = document.getElementById('tabla-body');
            tbody.innerHTML = "";
            
            tablaOrdenada.forEach((equipo, index) => {
                const info = obtenerInfoEquipo(equipo.equipo);
                const dif = equipo.gf - equipo.gc;
                const difColor = dif > 0 ? 'text-green-400' : dif < 0 ? 'text-red-400' : 'text-slate-400';
                
                const equipoHTML = info.escudo
                    ? `<div class="flex items-center gap-2">
                        <img src="${info.escudo}" alt="${equipo.equipo}" class="escudo-equipo">
                        <span class="${info.clase}">${equipo.equipo}</span>
                       </div>`
                    : equipo.equipo;
                
                tbody.innerHTML += `
                    <tr class="border-t border-white/5 hover:bg-white/5 transition-colors ${info.bgColor}">
                        <td class="py-2 sm:py-4 px-2 sm:px-4 font-bold text-slate-400 text-xs sm:text-base">${index + 1}</td>
                        <td class="py-2 sm:py-4 px-2 sm:px-4 font-bold text-xs sm:text-lg">${equipoHTML}</td>
                        <td class="py-2 sm:py-4 px-1 sm:px-3 text-center text-slate-400 text-xs sm:text-base">${equipo.pj}</td>
                        <td class="py-2 sm:py-4 px-1 sm:px-3 text-center text-green-400 text-xs sm:text-base">${equipo.pg}</td>
                        <td class="py-2 sm:py-4 px-1 sm:px-3 text-center text-slate-400 text-xs sm:text-base">${equipo.pe}</td>
                        <td class="py-2 sm:py-4 px-1 sm:px-3 text-center text-red-400 text-xs sm:text-base">${equipo.pp}</td>
                        <td class="py-2 sm:py-4 px-1 sm:px-3 text-center text-xs sm:text-base">${equipo.gf}</td>
                        <td class="py-2 sm:py-4 px-1 sm:px-3 text-center text-xs sm:text-base">${equipo.gc}</td>
                        <td class="py-2 sm:py-4 px-1 sm:px-3 text-center font-bold text-xs sm:text-base ${difColor}">${dif > 0 ? '+' : ''}${dif}</td>
                        <td class="py-2 sm:py-4 px-1 sm:px-3 text-center font-black text-lg sm:text-2xl">${equipo.pts}</td>
                    </tr>
                `;
            });
        }

        // Funci√≥n para descargar la tabla de posiciones
        async function descargarTabla() {
            const elemento = document.getElementById('tabla-captura');
            const boton = event.target.closest('button');
            
            // Deshabilitar el bot√≥n y mostrar estado de carga
            boton.disabled = true;
            boton.innerHTML = '<span class="animate-pulse">Generando imagen...</span>';
            
            try {
                const canvas = await html2canvas(elemento, {
                    backgroundColor: '#020617',
                    scale: 2,
                    logging: false,
                    useCORS: true,
                    allowTaint: true
                });
                
                // Convertir a JPG
                canvas.toBlob(function(blob) {
                    const url = URL.createObjectURL(blob);
                    const link = document.createElement('a');
                    const fecha = new Date().toISOString().split('T')[0];
                    link.download = `LOS_PIBES_6+6_Tabla_${torneoActual}_${fecha}.jpg`;
                    link.href = url;
                    link.click();
                    URL.revokeObjectURL(url);
                    
                    // Restaurar el bot√≥n
                    boton.disabled = false;
                    boton.innerHTML = `
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor">
                            <path fill-rule="evenodd" d="M3 17a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zm3.293-7.707a1 1 0 011.414 0L9 10.586V3a1 1 0 112 0v7.586l1.293-1.293a1 1 0 111.414 1.414l-3 3a1 1 0 01-1.414 0l-3-3a1 1 0 010-1.414z" clip-rule="evenodd" />
                        </svg>
                        Descargar JPG
                    `;
                }, 'image/jpeg', 0.95);
                
            } catch (error) {
                console.error('Error al generar la imagen:', error);
                alert('Error al generar la imagen. Por favor intenta nuevamente.');
                
                // Restaurar el bot√≥n
                boton.disabled = false;
                boton.innerHTML = `
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor">
                        <path fill-rule="evenodd" d="M3 17a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zm3.293-7.707a1 1 0 011.414 0L9 10.586V3a1 1 0 112 0v7.586l1.293-1.293a1 1 0 111.414 1.414l-3 3a1 1 0 01-1.414 0l-3-3a1 1 0 010-1.414z" clip-rule="evenodd" />
                    </svg>
                    Descargar JPG
                `;
            }
        }

        // Funci√≥n para descargar la tabla de goleadores
        async function descargarGoleadores() {
            const elemento = document.getElementById('goleadores-captura');
            const boton = event.target.closest('button');
            
            // Deshabilitar el bot√≥n y mostrar estado de carga
            boton.disabled = true;
            boton.innerHTML = '<span class="animate-pulse">Generando imagen...</span>';
            
            try {
                const canvas = await html2canvas(elemento, {
                    backgroundColor: '#020617',
                    scale: 2,
                    logging: false,
                    useCORS: true,
                    allowTaint: true
                });
                
                // Convertir a JPG
                canvas.toBlob(function(blob) {
                    const url = URL.createObjectURL(blob);
                    const link = document.createElement('a');
                    const fecha = new Date().toISOString().split('T')[0];
                    link.download = `LOS_PIBES_6+6_Goleadores_${fecha}.jpg`;
                    link.href = url;
                    link.click();
                    URL.revokeObjectURL(url);
                    
                    // Restaurar el bot√≥n
                    boton.disabled = false;
                    boton.innerHTML = `
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor">
                            <path fill-rule="evenodd" d="M3 17a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zm3.293-7.707a1 1 0 011.414 0L9 10.586V3a1 1 0 112 0v7.586l1.293-1.293a1 1 0 111.414 1.414l-3 3a1 1 0 01-1.414 0l-3-3a1 1 0 010-1.414z" clip-rule="evenodd" />
                        </svg>
                        Descargar JPG
                    `;
                }, 'image/jpeg', 0.95);
                
            } catch (error) {
                console.error('Error al generar la imagen:', error);
                alert('Error al generar la imagen. Por favor intenta nuevamente.');
                
                // Restaurar el bot√≥n
                boton.disabled = false;
                boton.innerHTML = `
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor">
                        <path fill-rule="evenodd" d="M3 17a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zm3.293-7.707a1 1 0 011.414 0L9 10.586V3a1 1 0 112 0v7.586l1.293-1.293a1 1 0 111.414 1.414l-3 3a1 1 0 01-1.414 0l-3-3a1 1 0 010-1.414z" clip-rule="evenodd" />
                    </svg>
                    Descargar JPG
                `;
            }
        }

        cambiarTorneo('Apertura');
        cambiarVista('proxima');
        cargarJugadoresCustom(); // Cargar jugadores personalizados al inicio
    </script>
</body>
</html>
